---
layout: post
title: "211128-TIL(react-query)"
subtitle: "TIL-211128"
categories: til
tags: til-2021-11
comments: false
---

![1-1](/assets/img/TIL.jpeg)

# react-query ì‚¬ìš©ë²•

---

<https://react-query.tanstack.com/>

react-queryë¥¼ ì„¤ì¹˜í•´ì¤€ë‹¤.

```
npm i react-query
```

ê·¸ë¦¬ê³  ì„¤ì¹˜í•œ react-queryë¥¼ importí•œ ë‹¤ìŒ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•œë‹¤.  
ğŸ—‚ index.tsx

```js
...
import { QueryClient, QueryClientProvider } from "react-query";
...

// ë‹¤ìŒ ì½”ë“œë¥¼ ì…ë ¥í•˜ê³ 
const queryClient = new QueryClient();

ReactDOM.render(
  <React.StrictMode>
  // QueryClientProviderë¡œ ThemeProviderë¥¼ ê°ì‹¸ì¤€ë‹¤.
  // ê·¸ë¦¬ê³  clientì— queryClientë¥¼ ë„£ì–´ì¤€ë‹¤.
    <QueryClientProvider client={queryClient}>
      <ThemeProvider theme={theme}>
        <App />
      </ThemeProvider>
    </QueryClientProvider>
  </React.StrictMode>,
  document.getElementById("root")
);
```

ê·¸ë¦¬ê³  ê¸°ì¡´ì˜ fetchë¶€ë¶„ì„ ë‹¤ë¥¸ íŒŒì¼ë¡œ ë¶„í•´í•œë‹¤.  
ğŸ—‚ src/api.tsx

```js
// ë°˜ë³µì˜ ìµœì†Œí™”
const BASE_URL = `https://api.coinpaprika.com/v1`;

export function fetchCoins() {
  return fetch(`${BASE_URL}/coins`).then((response) => response.json());
}

export function fetchCoinInfo(coinId: string) {
  return fetch(`${BASE_URL}/coins/${coinId}`).then((response) =>
    response.json()
  );
}

export function fetchCoinTickers(coinId: string) {
  return fetch(`${BASE_URL}/tickers/${coinId}`).then((response) =>
    response.json()
  );
}
```

ğŸ—‚ Coins.tsx

```js
function Coins() {
    // allCoinsëŠ” ê³ ìœ í•œ Queryí‚¤
    // isLoadingì€ react-queryì—ì„œ ìë™ìœ¼ë¡œ ìƒì„±í•œë‹¤. fetchCoins í•¨ìˆ˜ì—ì„œ fetch ì¤‘ì¼ ë•ŒëŠ”
    // trueë¡œ ì•„ë‹ ë•ŒëŠ” falseë¡œ ìë™ìœ¼ë¡œ ê´€ë¦¬í•´ì¤€ë‹¤.
    // dataì—ëŠ” fetchí•´ ì˜¨ ë°ì´í„°ê°€ ë“¤ì–´ê°€ê²Œ ëœë‹¤.
    // Query keyëŠ” react-query ìºì‹œ ì‹œìŠ¤í…œì—ì„œ ì €ì¥ë˜ê³  ì‘ë™í•˜ê¸° ìœ„í•´ì„œ ê³ ìœ í•œ ê°’ì´ì–´ì•¼í•œë‹¤.
  const { isLoading, data } = useQuery<ICoin[]>("allCoins", fetchCoins);
  /* const [coins, setCoins] = useState<ICoin[]>([]);
  const [loading, setLoading] = useState(true);
  useEffect(() => {
    (async () => {
      const response = await fetch("https://api.coinpaprika.com/v1/coins");
      const json = await response.json();
      setCoins(json.slice(0, 100));
      setLoading(false);
    })();
  }, []); */
  return (
    <Container>
      ...
    </Container>
  );
}

export default Coins;
```

ğŸ—‚ Coin.tsx

```js
function Coin() {
  const { coinId } = useParams<RouteParams>();
  const { state } = useLocation<RouteState>();
  const priceMatch = useRouteMatch("/:coinId/price");
  const chartMatch = useRouteMatch("/:coinId/chart");
  const { isLoading: infoLoading, data: infoData } = useQuery<InfoData>(
    ["info", coinId], // coinIdê°€ infoì—ë„ tickersì—ë„ ìˆìœ¼ë¯€ë¡œ []ë¡œ êµ¬ë¶„
    () => fetchCoinInfo(coinId) // argumentê°€ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ê³ ì°¨í•¨ìˆ˜ë¡œ
  );
  const { isLoading: tickersLoading, data: tickersData } = useQuery<PriceData>(
    ["tickers", coinId],
    () => fetchCoinTickers(coinId)
  );
  /* const [loading, setLoading] = useState(true);
  const [info, setInfo] = useState<InfoData>();
  const [priceInfo, setPriceInfo] = useState<PriceData>();
  useEffect(() => {
    (async () => {
      const infoData = await (
        await fetch(`https://api.coinpaprika.com/v1/coins/${coinId}`)
      ).json();
      const priceData = await (
        await fetch(`https://api.coinpaprika.com/v1/tickers/${coinId}`)
      ).json();
      setInfo(infoData);
      setPriceInfo(priceData);
      setLoading(false);
    })();
  }, [coinId]); */
  const loading = infoLoading || tickersLoading;
  return (
    <Container>
      ...
    </Container>
  );
}

export default Coin;
```

í•œ ì¤„ì˜ ì½”ë“œë¡œ ì•„ë˜ì˜ ë³µì¡í•œ ì½”ë“œë¥¼ í•´ê²°í•´ì¤€ë‹¤.

## ReactQueryDevtools ì‚¬ìš©í•´ì„œ cache ë¶„ì„ê°€ëŠ¥í•˜ê²Œ

---

<https://react-query.tanstack.com/devtools#_top>

ReactQueryDevtoolsë¥¼ í†µí•´ì„œ ìºì‹œì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶„ì„í•  ìˆ˜ ìˆë‹¤.

ğŸ—‚ App.tsx

```js
import { ReactQueryDevtools } from "react-query/devtools";
function App() {
  return (
    <>
      <GlobalStyle />
      <Router />
      <ReactQueryDevtools initialIsOpen={true} />
    </>
  );
}

export default App;
```

ìœ„ì˜ ì½”ë“œì™€ ê°™ì´ ì ì–´ì£¼ë©´ ê°„ë‹¨í•˜ê²Œ devtoolsë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

---
layout: post
title: "210902-TIL(React)"
subtitle: "TIL-210902"
categories: til
tags: til
comments: false
---

# ğŸ“ ê³µë¶€í•  ê±°ë¦¬
---



â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ like & unlike ê¸°ëŠ¥ íë¦„ ìˆœì„œ
---
1. í”„ë¡ íŠ¸ì—”ë“œì—ì„œ like ë²„íŠ¼ì„ ëˆ„ë¦„      

ğŸ—‚ front/component/PostCard.js      
```javascript
const PostCard = ({ post }) => {
    const onLike = useCallback(() => {
            dispatch({
                type: LIKE_POST_REQUEST,
                data: post.id,
            })
        }, []);
        const onUnLike = useCallback(() => {
            dispatch({
                type: UNLIKE_POST_REQUEST,
                data: post.id,
            })
        }, []);
    const id = useSelector((state) => state.user.me?.id);
    const liked = post.Likers.find((v) => v.id === id); 
    // í˜„ì¬ ë¡œê·¸ì¸í•œ ìœ ì €ê°€ í¬ìŠ¤íŠ¸ì— likeë¥¼ í•œ ìœ ì €ì¸ ì§€ ì°¾ëŠ”ë‹¤.
    return (
        <Card
        actions={[
        liked
            ? <HeartTwoTone twoToneColor="#eb2f96" key="heart" onClick={onUnLike} />
            // likeë¥¼ í–ˆë‹¤ë©´ ë¹¨ê°„ í•˜íŠ¸ì™€ unlikeê°€ ê°€ëŠ¥í•˜ë„ë¡ 
            : <HeartOutlined key="heart" onClick={onLike} />,
            // í•˜ì§€ ì•Šì•˜ë‹¤ë©´ likeë¥¼ í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±       
        ]}
        >
```
ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ onLikeê°€ dispatchë˜ë©´ì„œ LIKE_POST_REQUEST ì•¡ì…˜ì„ ë³´ë‚´ê²Œ ëœë‹¤. ì´ë•Œ ê²Œì‹œë¬¼ idë„ ê°™ì´ë³´ëƒ„       

2. ì•¡ì…˜ì€ reduxë¡œ ë“¤ì–´ê°€ì„œ      
ğŸ—‚ reducers/post.js     
```javascript
const reducer = (state = initialState, action) => {
    return produce(state, (draft) => { // stateê°€ ì´ë¦„ì´ draftë¡œ ë°”ë€œ
        switch (action.type) {
            case LIKE_POST_REQUEST:
                draft.loadPostLoading = true;
                draft.loadPostDone = false;
                draft.loadPostError = null;
                break;

            case LIKE_POST_SUCCESS: {
                const post = draft.mainPosts.find((v) => v.id === action.data.PostId);
                // mainPostsì—ì„œ ê²Œì‹œë¬¼ì˜ id ì¤‘ì—ì„œ í˜„ì¬ ë°›ì€ PostIdì™€ ê°™ì€ ê²Œì‹œë¬¼ì„ ì°¾ëŠ”ë‹¤.
                post.Likers.push({ id: action.data.UserId });
                // ê·¸ ê²Œì‹œë¬¼ì˜ Likerì— í˜„ì¬ ë¡œê·¸ì¸ í•œ UserIdë¥¼ ë„£ëŠ”ë‹¤.
                draft.loadPostLoading = false;
                draft.loadPostDone = true;
                break;
            }
            case LIKE_POST_FAILURE:
                draft.loadPostLoading = false;
                draft.loadPostError = action.error;
                break;
```                
ì´ êµ¬ì„±ì— ë§ì¶°ì„œ ì‘ë™í•˜ê²Œ ëœë‹¤.     
í˜„ì¬ ìœ ì €ëŠ” Likeë¥¼ ëˆ„ë¥¸ ìœ ì €ë¡œ ìƒíƒœê°€ ë°”ë€ë‹¤.       

3. sagaì—ì„œ ì•¡ì…˜ì„ ë¹‹ì•„ì„œ patchë¥¼ ì‹¤í–‰í•¨        
ğŸ—‚ sagas/post.js       
```javascript
function likePostAPI(data) { // ì œë„¤ë ˆì´í„° ì•„ë‹˜
    return axios.patch(`/post/${data}/like`);
}

function* likePost(action) {
    try {
        const result = yield call(likePostAPI, action.data);
        yield put({
            type: LIKE_POST_SUCCESS,
            data: result.data,
        });
    } catch (err) {
        yield put({
            type: LIKE_POST_FAILURE,
            data: err.response.data,
        })
    }
}
```

4. ë°±ì—”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì •ì„ ê±°ì¹œë‹¤.      
ğŸ—‚ routes/post.js       
```javascript
router.patch('/:postId/like', isLoggedIn, async (req, res, next) => { //PATCH /post/1/like
    try {
        const post = await Post.findOne({ where: { id: req.params.postId } });
        // postIdë¥¼ ì°¾ì•„ì„œ postë¥¼ ì°¾ê³ 
        if (!post) {
            return res.status(403).send('ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        }
        await post.addLikers(req.user.id); 
        // ë°ì´í„° ë² ì´ìŠ¤ì˜ addLikersë¡œ idë¥¼ ë„£ì–´ì¤Œ      
        res.json({ PostId: post.id, UserId: req.user.id });
    } catch (error) {
        console.error(error);
        next(error);
    }
})
```
ì´ ê³¼ì •ì„ ê±°ì³ì„œ ë°±ì—”ë“œì—ì„œ ë°ì´í„° ë² ì´ìŠ¤ê¹Œì§€ ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ëŠ” ê³¼ì •ì„ ì™„ì„±í•œë‹¤.        

5. ë§ˆì§€ë§‰ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¬ ë•Œë„ Likersë¥¼ ë°ì´í„°ë² ì´ìŠ¤ë¡œë¶€í„° ì˜ ë¶ˆëŸ¬ì™€ì•¼í•œë‹¤.      
ğŸ—‚ routers/posts.js
```javascript
router.get('/', async (req, res, next) => {
    try {
        const posts = await Post.findAll({
            limit: 10,
            order: [
                ['createdAt', 'DESC'],
                [Comment, 'createdAt', 'DESC'],
            ],
            include: [{
                model: User,
                attributes: ['id', 'nickname'],
            }, {
                model: Image,
            }, {
                model: Comment,
                include: [{
                    model: User,
                    attributes: ['id', 'nickname'],
                }]
            }, {
                model: User,
                as: 'Likers',
                attributes: ['id'],
            }],
        });
        // console.log(posts);
        res.status(200).json(posts);
```
ì´ ë¶€ë¶„ì—ì„œ 
```javscript
{
    model: User,
    as: 'Likers',
    attributes: ['id'],
}
```
ì´ likersë¥¼ ë¶ˆëŸ¬ ì˜¤ëŠ” ê±¸ ë„£ì–´ì£¼ì§€ ì•Šì•„ì„œ ëª‡ì‹œê°„ì„ í—¤ë§¸ëŠ”ì§€ ëª¨ë¥¸ë‹¤...ã…œã…œ



â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ useEffect ë§ˆì§€ë§‰ì— [] ì•ˆë„£ìœ¼ë©´ ì¼ì–´ë‚˜ëŠ” ì¼
---
![1-1](/assets/img/web/2021-09-03/1-1.png)          
ë¬´í•œ requestê°€ ì¼ì–´ë‚¨...        
ì¡°ì‹¬í•˜ì
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ 
---

â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>
---
layout: post
title: "210829-TIL(node.js, MySQL)"
subtitle: "TIL-210829"
categories: til
tags: til
comments: false
---

# ğŸ“ ê³µë¶€í•  ê±°ë¦¬
---

â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ app ì¢…ë¥˜
---
```javascript
app.get() -> ê°€ì ¸ì˜¤ê¸°
app.post() -> ë”ì´í„° ìƒì„±í•˜ê¸°
app.put() -> ì „ì²´ ìˆ˜ì •
app.delete() -> ì œê±°í•˜ê¸°
app.patch() -> ë¶€ë¶„ ìˆ˜ì •
app.options() -> ì°”ëŸ¬ë³´ê¸°
app.head() -> í—¤ë”ë§Œ ê°€ì ¸ë¡œê¸°
```

# MySQL
---

## â—ï¸  MySQL ì¤‘ê°„ì— ë¹„ë°€ë²ˆí˜¸ë¥¼ ì˜ëª»ì…ë ¥í–ˆê±°ë‚˜ ìŠì–´ë²„ë ¸ì„ ë•Œ ì´ˆê¸°í™” ë° ì¬ì„¤ì •í•˜ëŠ” ë°©ë²•
---
ì¶œì²˜:<https://velog.io/@nari120/MySQL8-%EB%B9%84%EB%B0%80%EB%B2%88%ED%98%B8-%EB%B6%84%EC%8B%A4-%EB%B0%8F-%EB%B3%80%EA%B2%BD>        
1. MySQL ì„œë²„ ë©ˆì¶”ê¸°
```
cd /opt/homebrew/opt/mysql/bin
brew services stop mysql
```
2. MySQL ì„œë²„ ì‹œì‘
ë¹„ë°€ë²ˆí˜¸ ì—†ì´ MySQLì— ì ‘ì†í•˜ê¸° ìœ„í•´ì„œ ì„œë²„ ìŠ¹ì¸ ìƒëµí•œë‹¤.
```
mysql.server start --skip-grant-tables
```
3. root ìœ ì €ë¡œ MySQLì— ì ‘ì†
ì•„ë˜ ëª…ë ¹ë¬¸ë§Œ ì…ë ¥í•´ë„ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì—†ì´ ì‹œì‘ëœë‹¤.
```
mysql -u root
```
4. mysql ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼
```
use mysql;
```
5. ê¶Œí•œ ë³€ê²½
```
FLUSH PRIVILEGES;
```
6. ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
```
ALTER USER 'root'@'localhost' IDENTIFIED BY 'pass';
```
>âœ… ì—¬ê¸°ì„œ íŒ¨ìŠ¤ì›Œë“œ ì •ì±…ì— ë”°ë¼ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •ì´ ë§‰í ìˆ˜ ìˆìŒ     
>ì¶œì²˜: <https://kamang-it.tistory.com/entry/MySQL%ED%8C%A8%EC%8A%A4%EC%9B%8C%EB%93%9C-%EC%A0%95%EC%B1%85-%ED%99%95%EC%9D%B8-%EB%B3%80%EA%B2%BD%ED%95%98%EA%B8%B0>
>```
>SHOW VARIABLES LIKE 'validate_password%'
>```
>ìì‹ ì´ ì„¤ì •í•œ or ì„ì˜ë¡œ ì„¤ì •ëœ ì •ì±…ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.       
>```
>SET GLOBAL validate_password_policy=LOW; <- MEDIUMìœ¼ë¡œ ë³€ê²½ë„ ê°€ëŠ¥
>```
>ì´ ëª…ë ¹ì–´ë¡œ ë¹„ë°€ë²ˆí˜¸ ì •ì±…ì„ ë°”ê¿€ ìˆ˜ ìˆë‹¤.(ë¼ê³  í•˜ëŠ”ë° ë‚´ê°€ í•  ë• ì•ˆëìŒ...)     
>ì—¬íŠ¼ ì •ì±…ì„ ì¤€ìˆ˜í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì¤€ë‹¤.

7. mysqlì„ ë”.
```
EXIT;
```
8. MySQL ì„œë²„ ë©ˆì¶”ê¸°
ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ë“¤ì–´ê°€ê¸° ìœ„í•´ì„œ ì²˜ìŒ ì‹œì‘ ë•Œ, ê±¸ì—ˆë˜ --skip-grant-tables ì˜µì…˜ì´ ë“¤ì–´ê°„ MySQL ì„œë²„ ë©ˆì¶”ê¸°
```
mysql.server stop
```
9. MySQL ì„œë²„ ì‹œì‘
```
mysql.server start
```
10. mysqlì— ë‹¤ì‹œ ì ‘ì†
ìœ„ì—ì„œ ì„¸íŒ…í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ë³´ë©´ ì§œì”. ëœë‹¤!
```
mysql -u root -p
```

## ğŸŒŸ MySQL ì‚¬ìš©í•˜ê¸°
---
MySQLì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•œë‹¤.     
```
$ brew install mysql
$ brew services start mysql
$ mysql_secure_installation
```
```
npm i sequelize sequelize-cli mysql2
```
mysql2ëŠ” nodeì™€ MySQLì„ ì´ì–´ì£¼ëŠ” ë„êµ¬       
sequelizeëŠ” ìë°”ìŠ¤íŠ¸ë¦½íŠ¸ë¡œ MySQLì„ ì¡°ì‘í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë„êµ¬       

ğŸ—‚ config/config.json       
```javascript
{
  "development": {
    "username": "root",
    "password": "ë¹„ë°€ë²ˆí˜¸",
    "database": "react-nodebird",
    "host": "127.0.0.1",
    "dialect": "mysql"
  },
  "test": {
    "username": "root",
    "password": null,
    "database": "react-nodebird",
    "host": "127.0.0.1",
    "dialect": "mysql"
  },
  "production": {
    "username": "root",
    "password": null,
    "database": "react-nodebird",
    "host": "127.0.0.1",
    "dialect": "mysql"
  }
}
```
ğŸ—‚ models/index.js      
```javascript
const Sequelize = require('sequelize');
const env = process.env.NODE_ENV || 'development'; 
// ë°°í¬í•  ë•ŒëŠ” process.env.NODE_ENV ëŒ€ì‹  productionì„ ì”€
const config = require('../config/config')[env];
// config.jsonì—ì„œ "development"ë¥¼ ë¶ˆëŸ¬ì˜´
const db = {};

const sequelize = new Sequelize(config.database, config.username, config.password, config);
// ì‹œí€„ë¼ì´ì¦ˆê°€ nodeë‘ MySQLì„ ì—°ê²°í•´ì¤Œ

Object.keys(db).forEach(modelName => {
  if (db[modelName].associate) {
    db[modelName].associate(db);
  }
});

db.sequelize = sequelize;
db.Sequelize = Sequelize;

module.exports = db;
```

## ğŸŒŸ Model ë§Œë“¤ê¸°
---
models ì•ˆì— í•„ìš”í•œ ëª¨ë¸ë“¤ì„ ë§Œë“¤ì–´ì¤€ë‹¤.     
í˜„ì¬ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” user, post, image, comment, hashtagê°€ í•„ìš”í•´ì„œ ë§Œë“¤ì–´ì£¼ì—ˆë‹¤.      
<br/>

ğŸ—‚ models/user.js  
```javascript
module.exports = (sequelize, DataTypes) => {
    const User = sequelize.define('User', { // MySQL user í…Œì´ë¸” ìƒì„±
        // MySQLì—ì„œ ë§Œë“¤ì–´ì£¼ëŠ” ê¸°ë³¸ idê°€ ìˆë‹¤.
        email: {
            type: DataTypes.STRING(30),
            allowNull: false, // falseì´ë©´ í•„ìˆ˜
            uniqe: true,
        },
        nickname: {
            type: DataTypes.STRING(30),
            allowNull: false,
        },
        password: {
            type: DataTypes.STRING(100),
            allowNull: false,
        },
    }, {
        charset: 'utf8',
        collate: 'utf8_general_ci', // í•œê¸€ ì €ì¥
    });
    User.associate = (db) => { };
    return User;
}
```
ë‹¤ë¥¸ ëª¨ë¸ë“¤ë„ ìœ„ì™€ ë¹„ìŠ·í•˜ê²Œ ë§Œë“¤ì–´ì¤€ë‹¤.
DataTypesì—ëŠ” STRING, TEXT, BOOLEAN, FLOAT ë“± ë‹¤ì–‘í•œ íƒ€ì…ì´ ìˆë‹¤.       

ê·¸ë¦¬ê³  ë‚´ìš©ì—ì„œ í•œê¸€ì„ ì“°ê³  ì‹¶ì„ ë•ŒëŠ”       
```javascript
{
    charset: 'utf8',
    collate: 'utf8_general_ci', // í•œê¸€ ì €ì¥
}
```
ì´ëª¨í‹°ì½˜ê¹Œì§€ í•„ìš”í•  ë•ŒëŠ” mb4ë¥¼ ì¶”ê°€í•´ì„œ utf8mb4ë¼ê³  ì ì–´ì¤€ë‹¤.              
```javascript
{
    charset: 'utf8mb4', // mb4ëŠ” ì´ëª¨í‹°ì½˜
    collate: 'utf8bm4_general_ci', // í•œê¸€ ì €ì¥
}
```
---
layout: post
title: "210823-TIL(javascript, Redux-saga)"
subtitle: "TIL-210823"
categories: til
tags: til
comments: false
---
# ğŸ“ ê³µë¶€í•  ê±°ë¦¬
---
blockingê³¼ non-blocking ì´ë€?


â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ populateì—ì„œ ê¹Šì´ì— ê´€í•´ì„œ ì£¼ì˜í•  ì‚¬í•­
---
![1-1](/assets/img/web/2021-08-23/1-1.png)      
populateë¥¼ ì‚¬ìš©í•´ì„œ ì–»ì€ dataë¥¼ ì‚¬ìš©í–ˆë”ë‹ˆ ì´ì™€ ê°™ì´ word.meanì˜ lengthë¥¼ ì°¾ì„ ìˆ˜ ì—†ë‹¤ê³  ë‚˜ì™”ë‹¤.        
ì²˜ìŒì—ëŠ” mean ë¶€ë¶„ì´ [Array]ë¡œ í‘œê¸°ë¼ì„œ ê·¸ëŸ° ì¤„ ì•Œì•˜ì§€ë§Œ ë¬¸ì œëŠ” populateë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— í•œ ì¸µ ë” ê¹Šì´ì˜ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤ëŠ” ê²ƒì„ ì•Œê²Œë˜ì—ˆë‹¤.       
ë”°ë¼ì„œ ë‹¤ìŒ ì½”ë“œì™€ ê°™ì´ ìˆ˜ì •í•´ ì£¼ì—ˆë‹¤.      
userController.js 
```javascript
export const see = async (req, res) => {
    const { id } = req.params;
    const wordsData = await User.findById(id).populate("words");

    return res.render("users/profile", { pageTitle: "Profile", words: wordsData.words });
    // wordsDataë¥¼ ê·¸ëŒ€ë¡œ ë³´ë‚´ëŠ” ê²ƒì´ ì•„ë‹Œ í•œ ì¸µ ë” ë“¤ì–´ê°„ wordsData.wordsì˜ ë°ì´í„°ë¥¼ ë³´ë‚´ì£¼ì—ˆë‹¤.
}
```


â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ populateëœ data sort í•˜ê¸°
---
<https://stackoverflow.com/questions/16352768/how-to-sort-a-populated-document-in-find-request>     
<br/>

populate ë˜ì§€ ì•Šì€ dataë“¤ì€ ë‹¤ìŒê³¼ ê°™ì´ sort í•  ìˆ˜ ìˆë‹¤.     
```javascript
const words = await Word.find({}).sort({ createdAt: "desc" })
```
í•˜ì§€ë§Œ populateëœ dataë“¤ì€ ê·¸ëƒ¥ ë’¤ì— sortë¥¼ ë¶™ì—¬ì¤€ë‹¤ê³  í•´ì„œ ì •ë ¬ë˜ì§€ ì•ŠëŠ”ë‹¤.        
<br/> 

âŒ ì˜ëª»ëœ ë°©ë²•
```javascript
const wordsData = await User.findById(id).populate("words");
```
âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
```javascript
const wordsData = await User.findById(id).populate({ 
    path: "words", 
    options: { 
        sort: { createdAt: "desc" } 
        } 
    });
```


â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸredux-saga
---
middleware ê¸°ëŠ¥ ë‹´ë‹¹        
configureStore.js
```javascript
import { all, call, fork, put, take } from "@redux-saga/core/effects";
import axios from 'axios';

//function ì œë„¤ë ˆì´í„° ì•„ë‹˜
function logInAPI(data) { // (3) callì„ í•´ì„œ ë°›ì€ logInAPI(action.data)ì„
    return axios.post('/api/login', data);
}

function* logIn(action) { // (1)watchLogIní•¨ìˆ˜ì—ì„œ ë°›ì€ actionì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ìŒ
    try {
        const result = yield call(logInAPI, action.data); // (2)actionìœ¼ë¡œ ë°›ì€ ë¡œê·¸ì¸ dataê°€ ë“¤ì–´ìˆìŒ
        yield put({
            type: 'LOG_IN_SUCCESS',
            data: result.data,
        })
    } catch (err) {
        yield put({ // putì€ dispatchë¼ê³  ìƒê°
            type: 'LOG_IN_FAILURE', // Actionì´ë¼ê³  ìƒê°
            data: err.response.data,
        })
    }
}

function logOutAPI() { // ì œë„¤ë ˆì´í„° ì•„ë‹˜
    return axios.post('/api/logout');
}

function* logOut() {
    try {
        const result = yield call(logOutAPI);
        yield put({
            type: 'LOG_OUT_SUCCESS',
            data: result.data,
        })
    } catch (err) {
        yield put({
            type: 'LOG_OUT_FAILURE',
            data: err.response.data,
        })
    }
}

function addPostAPI(data) { // ì œë„¤ë ˆì´í„° ì•„ë‹˜
    return axios.post('/api/post', data);
}

function* addPost(action) {
    try {
        const result = yield call(addPostAPI, action.data);
        yield put({
            type: 'Add_POST_SUCCESS',
            data: result.data,
        })
    } catch (err) {
        yield put({
            type: 'Add_POST_FAILURE',
            data: err.response.data,
        })
    }
}

function* watchLogIn() {
    yield take('LOG_IN_REQUEST', logIn); //LOG_IN_REQUEST ì´ë¼ëŠ” ëª…ë ¹ì´ ì‹œí–‰ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
}

function* watchLogOut() {
    yield take('LOG_OUT_REQUEST', logOut);
}

function* watchAddPost() {
    yield take('ADD_POST_REQUEST', addPost);
}

export default function* rootSaga() {
    yield all([ // ë°°ì—´ ì•ˆì— ìˆëŠ” ëª¨ë“  ê²ƒì„ ì‹¤í–‰
        fork(watchLogIn),   // forkëŠ” í•¨ìˆ˜ë¥¼ ì‹¤í–‰
        fork(watchLogOut),
        fork(watchAddPost),
    ]);
}
```

â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸcall ì´ë‘ forkì˜ ì°¨ì´?
---
fork: ë¹„ë™ê¸° í•¨ìˆ˜í˜¸ì¶œ       
call: ë™ê¸° í•¨ìˆ˜ í˜¸ì¶œ

```javascript
function logInAPI() {
    return axios.post('/api/login');
}

const result = yield call(logInAPI);
// callì„ í•˜ë©´ call í•¨ìˆ˜ê°€ logInAPIí•¨ìˆ˜ë¥¼ ë¶ˆëŸ¬ì„œ ì‹¤í–‰í•œ ë’¤
// returní•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦° í›„ ê°’ì„ ë°›ì•„ì„œ resultì— ë„£ìŒ

// callì€ ì•„ë˜ ì½”ë“œë‘ ë¹„ìŠ·í•¨
axios.post('/api/login')
    .then(() => { // thenì„ í•´ì„œ ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¼
        yield put({
            type: 'LOG_IN_SUCCESS',
            data: result.data,
        })
    })

const reuslt = yield fork(logInAPI);
// forkëŠ” ë¹„ë™ê¸°ì´ê¸° ë•Œë¬¸ì— ìš”ì²­ì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³ 
// ë°”ë¡œ ë‹¤ìŒ ì½”ë“œë¥¼ ì‹¤í–‰í•œë‹¤. non-blocking

// forkëŠ” ì•„ë˜ì½”ë“œë‘ ë¹„ìŠ·í•¨
axios.post('/api/login');
yield put({ // ë¹„ë™ê¸°ì´ê¸° ë•Œë¬¸ì— thenì„ í•´ì„œ ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¬ì§€ ì•ŠìŒ
    type: 'LOG_IN_SUCCESS',
    data: result.data,
})
```
í˜„ì¬ ì½”ë“œì—ì„œëŠ” forkë¥¼ í•˜ë©´ ë§ì´ ì•ˆëœë‹¤. ì™œëƒí•˜ë©´ resultê°’ì„ ì•„ì§ ë°›ì§€ ì•Šì•˜ëŠ”ë°. data: result.dataì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ errorê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ì—       

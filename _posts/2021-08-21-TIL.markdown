---
layout: post
title: "210821-TIL(Redux)"
subtitle: "TIL-210821"
categories: til
tags: til
comments: false
---

## ğŸŒŸTestë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„° ì…ë ¥
---
reducers/post.js        
```javascript       
// postì— í•„ìš”í•œ state êµ¬ì¡°ë“¤ì„ ì €ì¥
export const initialState = {
    mainPosts: [{
        id: 1,
        User: { // backì—”ë“œì˜ ìºëŸ¬ì…€ì—ì„œ ì²«ê¸€ìë¥¼ ëŒ€ë¬¸ìë¡œ í•´ì£¼ê¸° ë•Œë¬¸ì— ë§ì¶¤
            id: 1,
            nickname: 'Doraemon',
        },
        content: 'ì²«ë²ˆì§¸ ê²Œì‹œê¸€ #í•´ì‹œíƒœê·¸ #ìµìŠ¤í”„ë ˆìŠ¤',
        Images: [{
            src: "https://images.unsplash.com/"
        }],
        Comments: [{
            User: {
                nickname: 'nero',
            },
            content: 'ë³´ê¸° ì¢‹ìŠµë‹ˆë‹¤.',
        }, {
            User: {
                nickname: 'Pikachu',
            },
            content: "ì•„ë¦„ë‹µë„¤ìš”."
        }]
    }],
    imagePaths: [], // ì´ë¯¸ì§€ê°€ ì €ì¥ë  ê³µê°„
    postAdded: false,
}

const ADD_POST = 'ADD_POST'; 
// ì˜¤íƒ€ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ => ""ì•ˆì—ì„œ ì‘ë™í•˜ì§€ ì•ŠëŠ” ìë™ì™„ì„±ê¸°ëŠ¥ ë–„ë¬¸
export const addPost = {
    // dispatchì•  ì‚¬ìš©ë  Action
    type: ADD_POST,
}

const dummyPost = { // ë‹¨ìˆœí…ŒìŠ¤íŠ¸ ìš©
    id: 2,
    content: 'ë”ë¯¸ë°ì´í„° ì…ë‹ˆë‹¤.',
    User: {
        id: 1,
        nickname: 'Doraemon',
    },
    Images: [],
    Comments: []
}

const reducer = (state = initialState, action) => {
    // ìœ„ì—ì„œë§Œë“  initialStateë¥¼ ê°€ì ¸ì™€ì„œ ì‚¬ìš©
    switch (action.type) {
        case ADD_POST:
            // ë§Œì•½ dispatch(addPost)ë¼ëŠ” ëª…ë ¹ì´ ë“¤ì–´ì˜¤ë©´ ì‘ë™
            return {
                ...state, // ê¸°ì¡´ ê²Œì‹œë¬¼ 
                mainPosts: [dummyPost, ...state.mainPosts],
                // ì¶”ê°€ ë˜ëŠ” ê²Œì‹œë¬¼ì„ ì•ì— ì…ë ¥í•´ì•¼ ìµœìƒë‹¨ì— ìœ„ì¹˜í•¨
                postAdded: true,
            }
        default:
            return state
    }
}

export default reducer;
```     
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
## ğŸŒŸê²Œì‹œê¸€ ì˜¬ë¦¬ëŠ” í™”ë©´ ë§Œë“¤ê¸°
---
pages/index.js
```javascript
import { useSelector } from "react-redux";

import AppLayout from "../components/AppLayout";
import PostCard from "../components/PostCard";
import PostForm from "../components/PostForm";


const Home = () => {
    const { isLoggedIn } = useSelector((state) => state.user);
    const { mainPosts } = useSelector((state) => state.post);
    return (
        <AppLayout>
            {isLoggedIn && <PostForm />} 
            //login í–ˆì„ ë•Œë§Œ ê²Œì‹œê¸€ ì‘ì„±í¼ì´ ë³´ì„
            {mainPosts.map((post) => <PostCard key={post.id} post={post} />)}
            // reduxì˜ stateì— ì €ì¥ëœ mainPostsì— ì €ì¥ëœ ì •ë³´ë¥¼ PostCardì— ë‹´ì•„ì„œ í‘œì‹œí•¨
        </AppLayout>
    )
}

export default Home;
```     
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      

## ğŸŒŸPostForm ì‘ì„±
---
ìƒˆ ê¸€ì„ ì‘ì„±í•˜ëŠ” ê³µê°„ì„ ë§Œë“¦        
```javascript
import { Form, Button, Input } from "antd";
import { useState, useCallback, useRef } from "react";
import { useSelector, useDispatch } from "react-redux";

import { addPost } from "../reducers/post";

const PostForm = () => {
    const { imagePaths } = useSelector((state) => state.post);
    const dispatch = useDispatch();

    const imageInput = useRef(); // ì‹¤ì œ domì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œ ref ì‚¬ìš©

    const [text, setText] = useState('');
    const onChangeText = useCallback((e) => {
        setText(e.target.value);
    }, []);

    const onSubmit = useCallback(() => {
        dispatch(addPost);
        setText('');
    }, []);

    // ì´ë¯¸ì§€ íŒŒì¼ ì˜¬ë¦¬ëŠ” ì°½ ë§Œë“œëŠ” ë°©ë²• âœ…
    const onClickImageUpload = useCallback(() => {
        imageInput.current.click();
    }, [imageInput.current]);

    return (
        <Form 
            style={{ margin: '10px 0 20px' }} 
            encType="multipart/form-data" 
            onFinish={onSubmit}
            >
            <Input.TextArea
                value={text}
                onChange={onChangeText}
                maxLength={140}
                placeholder="ì–´ë–¤ ì‹ ê¸°í•œ ì¼ì´ ìˆì—ˆë‚˜ìš”?"
            />
            <div>
                <input type="file" multiple hidden ref={imageInput} />
                //ì´ë¯¸ì§€ ì—…ë¡œë“œ, hidden: ë³´ì´ì§€ ì•Šì§€ë§Œ ê°’ì€ ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ” ì»¨íŠ¸ë¡¤. 
                <Button onClick={onClickImageUpload}>ì´ë¯¸ì§€ ì—…ë¡œë“œ</Button>
                <Button type="primary" style={{ float: "right" }} htmlType="submit">ì§¹ì§¹</Button>
            </div>
            <div>
                {imagePaths.map((v) => (
                    <div key={v} style={{ display: "inline-block " }}>
                        <img src={v} style={{ width: '200px ' }} alt={v} />
                        <div>
                            <Button>ì œê±°</Button>
                        </div>
                    </div>
                ))}
            </div>

        </Form>
    )
}

export default PostForm;
```     
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°          

## ğŸŒŸoptional chaining ì—°ì‚°ì
---
```javascript
const { me } = useSelector((state) => state.user);
const id = me?.id;
                |
                |
                V
const id = useSelector((state) => state.user.me?.id);
```     
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
## ğŸŒŸPostCard
---
PostCardëŠ” pages/index.jsì—ì„œ reduxë¡œë¶€í„° ë°›ì•„ì˜¨ state.post.mainPostsì˜ ë‚´ìš©ì„ ê·¸ë¦¬ëŠ” componentì´ë‹¤.        
<br/>

components/PostCard.js
```javascript
import React, { useState, useCallback } from 'react'
import { useSelector } from 'react-redux';

import PropTypes from 'prop-types';

import { Button, Card, Popover } from 'antd'
import Avatar from 'antd/lib/avatar/avatar';
import { RetweetOutlined, HeartOutlined, MessageOutlined, EllipsisOutlined, HeartTwoTone } from '@ant-design/icons';

import PostImages from './PostImages';

const PostCard = ({ post }) => {
    const [liked, setLinked] = useState(false);
    const [commentFormOpened, setCommentFormOpened] = useState(false);
    const onToggleLike = useCallback(() => {
        setLinked((prev) => !prev);
        // ì´ì „ stateë¥¼ ë‚˜íƒ€ë‚´ëŠ” prevë¥¼ ë°˜ëŒ€ë¡œ ë’¤ì§‘ì–´ì£¼ëŠ” ë¡œì§
        // í•˜íŠ¸ì— ë¶ˆì´ ë“¤ì–´ì˜´
    }, []);
    const onToggleComment = useCallback(() => {
        setCommentFormOpened((prev) => !prev);
        // ë§ˆì°¬ê°€ì§€ë¡œ ì´ì „ stateë¥¼ ë’¤ì§‘ìŒ
        // comment ë³´ê¸° ë€ì„ ì ‘ê±°ë‚˜ í¼ ìˆ˜ ìˆìŒ
    }, [])

    const id = useSelector((state) => state.user.me?.id);
    return (
        <div style={{ marginBottom: 20 }}>
            <Card
                cover={post.Images[0] && <PostImages images={post.Images} />}
                actions={[
                    <RetweetOutlined key="retweet" />,
                    liked
                        ? <HeartTwoTone twoToneColor="#eb2f96" key="heart" onClick={onToggleLike} />
                        : <HeartOutlined key="heart" onClick={onToggleLike} />,
                    <MessageOutlined key="comment" onClick={onToggleComment} />,
                    <Popover key="more" content={(
                        <Button.Group>
                            {id && post.User.id === id ? (
                                <>
                                    <Button>ìˆ˜ì •</Button>
                                    <Button type="danger">ì‚­ì œ</Button>
                                </>
                            ) : <Button>ì‹ ê³ </Button>}
                        </Button.Group>
                    )}>
                        <EllipsisOutlined />
                    </Popover>
                ]}
            >
                <Card.Meta
                    avatar={<Avatar>{post.User.nickname[0]}</Avatar>}
                    title={post.User.nickname}
                    description={post.content}
                />
            </Card>
            {commentFormOpened && (
                <div>
                    <CommentForm post={post} />
                    // commentFormì—ì„œëŠ” postì˜ idë¥¼ ì–»ê¸° ìœ„í•´ì„œ postë¥¼ ë³´ëƒ„
                    <List
                        header={`${post.Comments.length}ê°œì˜ ëŒ“ê¸€`}
                        itemLayout="horizontal"
                        dataSource={post.Comments}
                        renderItem={(item) => (
                            <li>
                                <Comment
                                    author={item.User.nickname}
                                    avatar={<Avatar>{item.User.nickname[0]}</Avatar>}
                                    content={item.content}
                                />
                            </li>
                        )} />
                </div>
            )}
            {/* <CommentForm post={post}/> // ê²Œì‹œê¸€ì˜ idë¥¼ ì–»ê¸° ìœ„í•´ postë¥¼ ì „ë‹¬
            <Comments /> */}
        </div >
    )
}

PostCard.propTypes = {
    post: PropTypes.shape({
        id: PropTypes.number,
        User: PropTypes.object,
        content: PropTypes.string,
        createdAt: PropTypes.object,
        Comments: PropTypes.arrayOf(PropTypes.object),
        Images: PropTypes.arrayOf(PropTypes.object),
    }).isRequired,
}

export default PostCard
```     
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      

## ğŸŒŸ CommentForm
---
Commentë¥¼ ë“±ë¡í•˜ëŠ” ì°½ì— ëŒ€í•œ ì„¤ì •       
```javascript
import React, { useCallback } from 'react';
import PropTypes from "prop-types";

import { Form, Input, Button } from 'antd';

import useInput from '../hooks/useinput';
import { useSelector } from 'react-redux';

// component/PostCard.jsì—ì„œ ë°›ì€ post (idë¥¼ ë°›ì•„ì˜¤ê¸° ìœ„í•´)
const CommentForm = ({ post }) => {
    const id = useSelector((state) => state.user.me?.id);
    const [commentText, onChangeCommentText] = useInput('');
    const onSubmitComment = useCallback(() => {
        console.log(post.id, commentText);
    }, [commentText])
    return (
        <Form onFinish={onSubmitComment}>
            <Form.Item style={{ position: 'relative', margin: 0 }}>
                <Input.TextArea value={commentText} onChange={onChangeCommentText} rows={4} />
                <Button style={{ position: 'absolute', right: 0, bottom: -40 }} type="primary" htmlType="submit">ì‚ì•½</Button>
            </Form.Item>
        </Form>
    )
}

CommentForm.propTypes = {
    post: PropTypes.object.isRequired,
}

export default CommentForm

```
---
layout: post
title: "210828-TIL(css, redux-sagas)"
subtitle: "TIL-210828"
categories: til
tags: til
comments: false
---

# ğŸ“ ê³µë¶€í•  ê±°ë¦¬
---
1. react-virtualizedì— ëŒ€í•´ì„œ: í™”ë©´ì— ë³´ì´ëŠ” ì •ë„ì˜ ê²Œì‹œë¬¼ë§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ëŠ” í™”ë©´ì—ì„œ ì§€ìš°ê³  ë©”ëª¨ë¦¬ì— ë„£ëŠ” ê¸°ìˆ            
<https://github.com/bvaughn/react-virtualized>      

2. concat       

```javascript
const array1 = ['a', 'b', 'c'];
const array2 = ['d', 'e', 'f'];
const array3 = array1.concat(array2);

console.log(array3);
// expected output: Array ["a", "b", "c", "d", "e", "f"]
```     

3. useEffect()ì—ì„œ addEventListenerë¥¼ í•œ ë’¤ return () => {removeEventListener}ì„ í•´ì£¼ì–´ì•¼í•˜ëŠ” ì´ìœ ?     
í•´ì£¼ì§€ ì•Šìœ¼ë©´ ê³„ì† ë©”ëª¨ë¦¬ì— ìŒ“ì—¬ì„œ ì¥í•´ë¥¼ ì¼ìœ¼í‚´        

â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ viewport
---
```html
<meta name="viewport" content="width=deice-width, initial-scale=1, minimum=1, maximum-scale=1, user-scalable=no">
```
width => ë·°í¬íŠ¸ì˜ ë„ˆë¹„ ì„¤ì •     
initial-scale => ì´ˆê¸° ë°°ìœ¨ ì„¤ì •     
minimum-scale => ìµœì†Œ ì¶•ì†Œ ë¹„ìœ¨ ì„¤ì •        
maximum-scale => ìµœëŒ€ í™•ëŒ€ ë¹„ìœ¨ ì„¤ì •        
user-scalable => í™•ëŒ€/ì¶•ì†Œ ì—¬ë¶€ ì„¤ì •        

â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ ë°˜ì‘í˜• ì›¹ ê¸°ê¸° ì‚¬ì´ì¦ˆ
---
ëª¨ë°”ì¼ => 320px     
í…Œë¸”ë¦¿ => 768px     
PCìš© => 960px or 1024px     

```css
/* ëª¨ë°”ì¼ìš© CSS */
...

/* íƒœë¸”ë¦¿ìš© CSS */
@media all and (min-width: 768px) {
    ...
}

/* PCìš© CSS */
@media all and (min-width: 960px){
    ...
}
```

â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ faker Library
---
<https://www.npmjs.com/package/faker>   
ë§ì€ ìƒ˜í”Œì„ ì§ì ‘ ì…ë ¥í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— faker ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì•˜ë‹¤.           
```
npm i faker
```

ğŸ—‚ reducers/post.js        
```javascript
initialState.mainPosts = initialState.mainPosts.concat(
    Array(20).fill().map(() => ({
        id: shortId.generate(),
        User: {
            id: shortId.generate(),
            nickname: faker.name.findName(),
        },
        content: faker.lorem.paragraph(),
        Images: [{
            src: faker.image.image(),
        }],
        Comments: [{
            User: {
                id: shortId.generate(),
                nickname: faker.name.findName(),
            },
            content: faker.lorem.sentence(),
        }],
    })),
)
```
![1-1](/assets/img/web/2021-08-28/1-1.png)  
ìœ„ì˜ ì‚¬ì§„ê³¼ ê°™ì€ fake í™”ë©´ì´ ë‚˜íƒ€ë‚¨


â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ infinite scroll
---
ë¬´í•œ ìŠ¤í¬ë¡¤ì´ ê°€ëŠ¥í•˜ê²Œ ë˜ë©´ ì‚¬ìš©ìë“¤ë„ ë” í¸ë¦¬í•¨ì„ ëŠë‚Œ     

ğŸ—‚ reducers/post.js        
```javascript
export const initialState = {
    ...
    hasMorePost: true, // ë” ë¶ˆëŸ¬ì˜¬ ê²Œì‹œë¬¼ì´ ìˆëŠ”ì§€ í™•ì¸

    // ìƒíƒœ ë³€ìˆ˜
    loadPostLoading: false,
    loadPostDone: false,
    loadPostError: null,
    ...
}

export const LOAD_POST_REQUEST = 'LOAD_POST_REQUEST';
export const LOAD_POST_SUCCESS = 'LOAD_POST_SUCCESS';
export const LOAD_POST_FAILURE = 'LOAD_POST_FAILURE';

const reducer = (state = initialState, action) => {
    return produce(state, (draft) => { 
        switch (action.type) {
            case LOAD_POST_REQUEST:
                draft.loadPostLoading = true;
                draft.loadPostDone = false;
                draft.loadPostError = null;
                break;

            case LOAD_POST_SUCCESS:
                draft.loadPostLoading = false;
                draft.loadPostDone = true;
                draft.mainPosts = action.data.concat(draft.mainPosts); // mainPostsì— ì¶”ê°€ë˜ëŠ” ê²Œì‹œë¬¼ì„ ì´ì–´ë¶™ì„
                draft.hasMorePost = draft.mainPosts.length < 50; // ë§ë¶™ì¸ ê¸¸ì´ê°€ 50ì„ ë„˜ëŠ”ê°€?
                break;

            case LOAD_POST_FAILURE:
                draft.loadPostLoading = false;
                draft.loadPostError = action.error;
                break;
            ...
        }
    }
}
```     

ğŸ—‚ sagas/post.js       
```javascript
import {
    ...
    LOAD_POST_REQUEST,
    LOAD_POST_SUCCESS,
    LOAD_POST_FAILURE,
    generateDummyPost,
} from '../reducers/post';

unction loadPostAPI(data) { // ì œë„¤ë ˆì´í„° ì•„ë‹˜
    return axios.get('/api/post', data);
}

function* loadPost(action) {
    try {
        // const result = yield call(loadPostAPI, action.data);
        yield delay(1000);
        yield put({
            type: LOAD_POST_SUCCESS,
            data: generateDummyPost(10), // ë”ë¯¸ ë°ì´í„° 10ê°œ ë§Œë“¤ì–´ì„œ ë³´ëƒ„
        });
    } catch (err) {
        yield put({
            type: LOAD_POST_FAILURE,
            data: err.response.data,
        })
    }
}

function* watchloadPost() {
    yield throttle(5000, LOAD_POST_REQUEST, loadPost);
}

export default function* postSaga() {
    yield all([
        fork(watchAddPost),
        fork(watchloadPost),
        fork(watchRemovePost),
        fork(watchAddComment),
    ])
}
```     

ğŸ—‚ pages/index.js       
```javascript
const Home = () => {
    const dispatch = useDispatch();
    const { mainPosts, hasMorePost, loadPostLoading } = useSelector((state) => state.post);

    useEffect(() => {
        dispatch({
            type: LOAD_POST_REQUEST,
        });
    }, []);

    useEffect(() => {
        function onScroll() {
            console.log(window.scrollY, document.documentElement.clientHeight, document.documentElement.scrollHeight);
            // scrollY: ì–¼ë§ˆë‚˜ ë‚´ë ¸ëŠ”ì§€, clientHeight: í™”ë©´ ë³´ì´ëŠ” ê¸¸ì´, scrollHeight: ì´ ê¸¸ì´
            if (window.scrollY + document.documentElement.clientHeight > document.documentElement.scrollHeight - 300) {
                // ìµœí•˜ë‹¨ìœ¼ë¡œ ë¶€í„° 300í”½ì…€ ë–¨ì–´ì§„ ê³³ì— ë„ë‹¬í•˜ë©´ ë‹¤ìŒ ê²Œì‹œë¬¼ì„ ë¶ˆëŸ¬ì˜´
                if (hasMorePost && !loadPostLoading) {
                    // ë‹¤ìŒ ê²Œì‹œë¬¼ì´ ìˆê³  í˜„ì¬ ë‹¤ìŒ ê²Œì‹œë¬¼ì„ ë¶ˆëŸ¬ì˜¤ê³  ìˆì§€ ì•Šìœ¼ë©´ dispatchë¥¼ ì‹¤í–‰í•¨
                    dispatch({
                        type: LOAD_POST_REQUEST,
                    });
                }
            }
        }
        window.addEventListener('scroll', onScroll);
        return () => {
            window.removeEventListener('scroll', onScroll); // removeEventListenerí•´ì£¼ì§€ ì•Šìœ¼ë©´ ë©”ëª¨ë¦¬ì— ìŒ“ì—¬ì„œ ì—†ì• ì£¼ì–´ì—¬í•¨
        }
    }, [hasMorePost, loadPostLoading])
}
```

â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ follow & unfollow
---
íŒ”ë¡œìš°, ì–¸íŒ”ë¡œìš° ê¸°ëŠ¥       
<br />


ğŸ—‚ components/PostCard.js       
```javascript
<Card
    cover={post.Images[0] && <PostImages images={post.Images} />}
    actions={[
        ...
    ]}
->  extra={id && <FollowButton post={post} />}
    >
```
idë¥¼ ë„£ì–´ì¤˜ì„œ ë¡œê·¸ì¸ í•œ ê²½ìš°ì—ë§Œ íŒ”ë¡œìš° ë²„íŠ¼ì´ ë³´ì´ë„ë¡ í•œë‹¤.       
<br/>

ğŸ—‚ components/FollowButton.js       
```javascript
import React, { useCallback } from 'react';
import { Button } from 'antd';
import PropTypes from 'prop-types';
import { useDispatch, useSelector } from 'react-redux';
import { FOLLOW_REQUEST, UNFOLLOW_REQUEST } from '../reducers/user';

const FollowButton = ({ post }) => {
    const dispatch = useDispatch();
    const { me, followLoading, unfollowLoading } = useSelector((state) => state.user);
    // ë‚´ ì •ë³´ì™€ loading ìƒíƒœë¥¼ ë¶ˆëŸ¬ì˜´
    const isFollowing = me?.Followings.find((v) => v.id === post.User.id);
    // me?.Followings => me && me.Followings
    // ë‚´ íŒ”ë¡œìš° ëª©ë¡ì— ìˆëŠ”ì§€ í™•ì¸

    const onClickButton = useCallback(() => {
        if (isFollowing) { // ëª©ë¡ì— ìˆë‹¤ë©´ ì–¸íŒ”ë¡œìš°
            dispatch({
                type: UNFOLLOW_REQUEST,
                data: post.User.id,
            })
        } else { // ì—†ë‹¤ë©´ íŒ”ë¡œìš°
            dispatch({
                type: FOLLOW_REQUEST,
                data: post.User.id,
            })
        }

    }, [isFollowing])

    return (
        <Button loading={followLoading || unfollowLoading} onClick={onClickButton}>
            {isFollowing ? 'ì–¸íŒ”ë¡œìš°' : 'íŒ”ë¡œìš°'}
        </Button>
    )
};

FollowButton.propTypes = {
    post: PropTypes.object.isRequired,
};

export default FollowButton;
```

ğŸ—‚ reducers/user.js        
```javascript
export const initialState = {
    followLoading: false, // íŒ”ë¡œìš° ì‹œë„ ì¤‘
    followDone: false,
    followError: null,

    unfollowLoading: false, // ì–¸íŒ”ë¡œìš° ì‹œë„ ì¤‘
    unfollowDone: false,
    unfollowError: null,
    ...
}

export const FOLLOW_REQUEST = 'FOLLOW_REQUEST';
export const FOLLOW_SUCCESS = 'FOLLOW_SUCCESS';
export const FOLLOW_FAILURE = 'FOLLOW_FAILURE';

export const UNFOLLOW_REQUEST = 'UNFOLLOW_REQUEST';
export const UNFOLLOW_SUCCESS = 'UNFOLLOW_SUCCESS';
export const UNFOLLOW_FAILURE = 'UNFOLLOW_FAILURE';

const reducer = (state = initialState, action) => {
    return produce(state, (draft) => {
        switch (action.type) {
            case FOLLOW_REQUEST:
                draft.followLoading = true;
                draft.followError = null;
                draft.followDone = false;
                break;

            case FOLLOW_SUCCESS:
                draft.followLoading = false;
                draft.followDone = true;
                draft.me.Followings.push({ id: action.data });
                // íŒ”ë¡œìš° ì„±ê³µí•˜ë©´ Followingsì— idë¥¼ ì§‘ì–´ ë„£ìŒ
                break;

            case FOLLOW_FAILURE:
                draft.followLoading = false;
                draft.followError = action.error;
                break;

            case UNFOLLOW_REQUEST:
                draft.unfollowLoading = true;
                draft.unfollowError = null;
                draft.unfollowDone = false;
                break;

            case UNFOLLOW_SUCCESS:
                draft.unfollowLoading = false;
                draft.unfollowDone = true;
                draft.me.Followings = draft.me.Followings.filter((v) => v.id !== action.data);
                // ì–¸íŒ”í•˜ë©´ ëª©ë¡ì—ì„œ ì–¸íŒ” í•œ ìœ ì €ë§Œ ë¹¼ê³  ë°°ì—´ ìƒì„±
                break;

            case UNFOLLOW_FAILURE:
                draft.unfollowLoading = false;
                draft.unfollowError = action.error;
                break;
            
            ...
        }
    }
}
```

ğŸ—‚ sagas/user.js
```javascript
function followAPI(data) {
    return axios.post('/api/follow', data);
}

function* follow(action) {
    try {
        yield delay(1000);
        yield put({
            type: FOLLOW_SUCCESS,
            data: action.data,
        })
    } catch (err) {
        yield put({
            type: FOLLOW_FAILURE,
            error: err.response.data,
        })
    }
}

function unfollowAPI(data) {
    return axios.post('/api/unfollow', data);
}

function* unfollow(action) {
    try {
        yield delay(1000);
        yield put({
            type: UNFOLLOW_SUCCESS,
            data: action.data,
        })
    } catch (err) {
        yield put({
            type: UNFOLLOW_FAILURE,
            error: err.response.data,
        })
    }
}
function* watchFollow() {
    yield takeLatest(FOLLOW_REQUEST, follow);
}

function* watchUnFollow() {
    yield takeLatest(UNFOLLOW_REQUEST, unfollow);
}
export default function* userSaga() {
    yield all([
        fork(watchFollow),
        fork(watchUnFollow),
        ...
    ])
}
```

â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›° 
---
layout: post
title: "210819-TIL(Redux)"
subtitle: "TIL-210819"
categories: til
tags: til
comments: false
---

# ğŸŒŸRedux
---
![ê·¸ë¦¼ 1-1](/assets/img/web/2021-08-19/1-1.png)         
ì¤‘ì•™ ì €ì¥ì†Œì˜ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì´ë¥¼ ë°”ê¾¸ê¸° ìœ„í•´ì„œëŠ” actionì´ë¼ëŠ” ê²ƒì´ í•„ìš”í•˜ë‹¤.
- action        
type: functionì˜ ì´ë¦„ ê°™ì€ ëŠë‚Œ     
data: ì‹¤ì œë¡œ ë°”ê¿€ ë‚´ìš©

ê·¸ë¦¬ê³  ì´ actionì„ dispatchí•˜ë©´ ë‚´ìš©ì´ ë°”ë€ë‹¤.      
í•˜ì§€ë§Œ ìì„¸íˆ ì´ì•¼ê¸°í•˜ë©´ dispatchë§Œ í•œë‹¤ê³  ë‚´ìš©ì´ ë°”ë€ŒëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.       
reduceë¼ëŠ” ê¸°ëŠ¥ì´ ìˆëŠ”ë° actionì—ì„œ ì§€ì •í•œ typeì˜ ì´ë¦„ì— í•´ë‹¹ í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” ê³¼ì •ì„ ê±°ì³ì•¼í•œë‹¤.       

ì¦‰, ì¤‘ì•™ ì €ì¥ì†Œì˜ ë°ì´í„°ë¥¼ ë°”ê¾¸ê¸° ìœ„í•´ì„œëŠ”      
actionì„¤ì • -> dispatch -> reduce caseì‘ì„± -> ë°ì´í„° ë²ˆê²½      
ì´ë¼ëŠ” ê³¼ì •ì„ ê±°ì¹œë‹¤.       

<br/>

ì¥ì : ë¦¬ë•ìŠ¤ë¥¼ ì“°ë©´ actionë“¤ì„ ì¶”ì í•´ì„œ ì—ëŸ¬ê°€ ë°œìƒí•œ ë¶€ë¶„ì„ ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆë‹¤.     
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
## ğŸŒŸë¶ˆë³€ì„±
---
```javascript
{} === {} // false
const a = {};
const b = a;
a === b // true
```
reducerì—ì„œ ë¶ˆë³€ì„±ì„ ì´ìš©í•˜ëŠ” ì´ìœ       
```javascript
return {
    ...state,
    name: action.data
} // ì´ë ‡ê²Œ í•˜ëŠ” ì´ìœ 


const prev = {name: 'one'}
const next = {name: 'two'}
// ì´ë ‡ê²Œ í•˜ë©´ ê³¼ê±°ì˜ ì •ë³´ê°€ ë°”ë€Œì§€ ì•ŠëŠ”ë‹¤.

const next = prev;
next.name = 'two';

prev.name; // two
// ì°¸ì¡°ê´€ê³„ì´ê¸° ë•Œë¬¸ì— ì›ë˜ ìˆë˜ oneì€ twoë¡œ ë®ì–´ì”Œì›Œì§
// ì¦‰, íˆìŠ¤í† ë¦¬ê°€ ì‚¬ë¼ì ¸ë²„ë¦¼

{
    ...state, //ë¥¼ í•´ì¤˜ì•¼ ì•ˆë°”ë€ŒëŠ” ê²ƒë“¤ì€ ì°¸ì¡°ê´€ê³„ë¥¼ ìœ ì¬í•´ì¤˜ì„œ ë©”ëª¨ë¦¬ë¥¼ ì•„ë‚„ ìˆ˜ ìˆë‹¤.
}

// ë¹„êµ

const nest = { b: 'c' };
const prev = { a: nest };

const next = { ...prev };

prev.a === next.a
// true

prev === next
// false

{ a: 'b' } === { a: 'b' }
// false
```     
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
## ğŸŒŸreducer ë§Œë“¤ê¸°       
---     
reducers/index.js        
```javascript
// initialStateì— formì„ ë§Œë“¤ì–´ì¤€ë‹¤.
const initialState = {
    user: {
        isLoggedIn: false,
        user: null,
        signUpDate: {},
        loginData: {},
    },
    post: {
        mainPosts: [],
    }
}

// actionì„ ë§Œë“¤ì–´ì¤€ë‹¤.
// dataëŠ” ì…ë ¥ ë°›ì„ ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ ë™ì ìœ¼ë¡œ ë§Œë“ ë‹¤.
export const loginAction = (data) => {
    return {
        type: 'LOG_IN',
        data,
    }
}

export const logoutAction = () => {
    return {
        type: 'LOG_OUT',
    }
}

const rootReducer = (state = initialState, action) => {
    switch (action.type){
        case 'LOG_IN':
            return {
                ...state,
                user: {
                    ...state.user,
                    isLoggedIn: true,
                    user: action.data,
                }
            }
        case 'LOG_OUT':
            return {
                ...state,
                user: {
                    ...state.user,
                    isLoggedIn: false,
                    user: null,
                }
            }
    }
}

export default rootReducer;
```

<br/>

AppLayout.js        
```
npm i react-redux
// reactì™€ reduxë¥¼ ì—°ê²°ì‹œì¼œì¤Œ
```

```javascript
import { useSelector } from 'react-redux';

const AppLayout =({ children}) => {
    const isLoggedIn = useSelector((state) => state.user.isLoggedIn);
    // react-reduxë¥¼ í†µí•´ì„œ ë°›ì•„ì˜´
    // isLoggedInì´ ë°”ë€Œë©´ AppLayout componentê°€ ë¦¬ëœë”ë§ ë¨

    return (
        <Row gutter={8}>
            <Col xs={24} md={6}>
                // {isLoggedIn ? <UserProfile setIsLoggedIn={setIsLoggedIn}/> : <LoginForm setIsLoggedIn={setIsLoggedIn}/>}
                // reduxì—ì„œ ë°›ì•„ì˜¤ë©´ ë˜ê¸° ë•Œë¬¸ì— setIsLoggedInë¥¼ í†µí•´ propsë¡œ ë„˜ê²¨ ì¤„ í•„ìš”ê°€ ì—†ì–´ì¡Œë‹¤.
                {isLoggedIn ? <UserProfile /> : <LoginForm />}
            </Col>
            ...
        </Row>
    )
}
```     
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°          
## ğŸŒŸuseSelector
---
useSelectorëŠ” reduxì— ìˆëŠ” ì¸ìë¥¼ ë°›ì•„ì˜´        
ë§Œì•½ì— reducersí´ë”ì—ì„œ index.jsíŒŒì¼ ì†ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ ìˆë‹¤ê³  í•˜ì.     
```javascript
const initialState = {
    user: {
        isLoggedIn: false,
        user: null,
        signUpDate: {},
        loginData: {},
    },
    post: {
        mainPosts: [],
    }
}
```
ì´ ì½”ë“œì˜ í˜•íƒœëŠ” ê·¸ëŒ€ë¡œ reduxì˜ êµ¬ì¡°ê°€ ëœë‹¤.        
ê·¸ë¦¬ê³  ì´ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ reduxì— ì•Œë ¤ì•¼í•œë‹¤.     
```javascript
const rootReducer = (state = initialState, action) => {
    switch (action.type){
        ...
}

export default rootReducer;
```
rootReducer í•¨ìˆ˜ì˜ stateì— ë„£ê³  exportí•˜ë©´ useSelectorë¡œ ì–´ë””ì„œë“  ë¶ˆëŸ¬ ì“¸ ìˆ˜ ìˆëŠ” reduxê°€ ì™„ì„±ë¤ë‹¤.     

<br/>

ì´ë¥¼ ë¶„ë¦¬í•´ ì¤„ ìˆ˜ ìˆë‹¤.     
ì•„ë˜ì—ì„œ reducer ìª¼ê°œê¸°ì—ì„œ ì‚´í´ë³¼í…Œì§€ë§Œ ë¯¸ë¦¬ ë³´ë©´      
initialStateì˜ ìš”ì†Œì¸ user, postë¥¼ ë‹¤ë¥¸ reduceríŒŒì¼ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤.       

reducers/user.js
```javascript
// ì´ë¯¸ userë¡œ íŒŒì¼ì„ ë‚˜ëˆ„ì—ˆê¸° ë•Œë¬¸ì— user: ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ ê¹Šì´ê°€ í•œ ë‹¨ê³„ ì˜¬ë¼ê°„ë‹¤.
const initialState = {
    //user: {
    isLoggedIn: false,
    user: null,
    signUpDate: {},
    loginData: {},
}

const reducer = (state = initialState, action) => {
    // ê·¸ë¦¬ê³  ì—¬ê¸°ì˜ stateì— initialStateë¥¼ ë„£ì–´ì¤€ë‹¤.
    switch (action.type) {
        ...
    }
}

export default reducer;
```

reducers/index.js       
```javascript       
import { HYDRATE } from "next-redux-wrapper";
import { combineReducers } from "redux";

import user from "./user";
// userì˜ stateë¥¼ ë¶ˆëŸ¬ì™€ì„œ ì“¸ ìˆ˜ ìˆìŒ
// ì‹ ê¸°í•˜ê²Œë„ reducerë¥¼ export í–ˆëŠ”ë° userë¼ê³  ì‚¬ìš©ê°€ëŠ¥
// export defaultë©´ ê´€ê³„ ì—†ë‚˜ë´„
import post from "./post";

const rootReducer = combineReducers({
    // SSRì„ ìœ„í•œ index
    index: (state = {}, action) => {
        ...
    },
    user, // ì—¬ê¸°ì— stateë¥¼ ì €ì¥
    post,
});

export default rootReducer;
```

â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
## ğŸŒŸuseDispatch
---
useDispatch ë˜í•œ ì¤‘ìš”í•˜ë‹¤.      
useDispatchë¥¼ í†µí•´ì„œ ì–´ë–¤ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.       

<br/>

LoginForm.js
```javascript
import { useDispatch } from 'react-redux';
// reducersì—ì„œ ë§Œë“¤ì–´ ì¤€ ëª…ë ¹ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” useDispatchê°€ í•„ìš”
import { loginAction } from "../reducers/user";
// userì—ì„œ ë§Œë“  loginActionì„ ë¶ˆëŸ¬ì˜´

const LoginForm = () => { //props ì§€ì›€
    const dispatch = useDispatch();

    const onSubmitForm = useCallback(() => {
        dispatch(loginAction({id, password}));
        // dispatchê°€ loginActionì„ ì‹¤í–‰í•¨
    }, [])
}
```     
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      

### ğŸŒŸHYDRATE 
---
reducer/index.js
```
import { HYDRATE } from "next-redux-wrapper"
```
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
## ğŸŒŸMiddleware
---
ê°œë°œì ë„êµ¬ì™€ ì—°ë™ê°€ëŠ¥í•˜ê²Œ ì„¤ì¹˜
```
npm i redux-devtools-extension
```

configureStore.js       
```javascript
import { applyMiddleware, createStore, compose } from 'redux';
import { composeWithDevTools } from 'redux-devtools-extension';

const configureStore = () => {
    const middlewares = [];
    const enhancer = process.env.NODE_ENV === 'production'
        ? compose(applyMiddleware(...middlewares)) // ê°œë°œ ëª¨ë“œì¼ ë•ŒëŠ” ì—ëŸ¬ë¥¼ ì°¾ê¸° ì‰½ê²Œ ë¡œê·¸ë¥¼ ë‚¨ê¹€
        : composeWithDevTools(applyMiddleware(...middlewares)) // ë°°í¬ëª¨ë“œì¼ ë•ŒëŠ” ë¡œê·¸ë¥¼ ë‚¨ê¸°ì§€ ì•ŠìŒ
    const store = createStore(reducer, enhancer);
    return store;
}
```     
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
## ğŸŒŸreducer ìª¼ê°œê¸°
---
reducer/post.js & user.js íŒŒì¼ ìƒì„±     
<br/>

reducer/user.js     
```javascript
// index.jsì— ìˆë˜ userì— ê´€ë ¨ëœ initialState ìš”ì†Œ ê°€ì ¸ì˜´
export const initialState = {
    isLoggedIn: false,
    user: null,
    signUpData: {},
    loginData: {},
}

// userì™€ ê´€ë ¨ëœ actionì„ ì „ë¶€ user.jsì— ì‘ì„±
export const loginAction = (data) => {
    return {
        type: "LOG_IN",
        data,
    }
}

export const logoutAction = () => {
    return {
        type: "LOG_OUT",
    }
}

const reducer = (state = initialState, action) => {
    switch (action.type) {
    ...
    }
}

export default reducer;
```
reducer/post.js     
```javascript
// postì— ê´€ë ¨ëœ initialState ì „ë¶€ ê°€ì ¸ì˜´
export const initialState = {
    mainPosts: [],
}

const reducer = (state = initialState, action) => {
    switch (action.type) {

        default:
            return state
    }
}

export default reducer;
```

reducer/index.js
```javascript
import { HYDRATE } from "next-redux-wrapper";
// SSR ëœë”ë§ì„ ìœ„í•œ ê²ƒ
import { combineReducers } from "redux";
// í•¨ìˆ˜ì™€ í•¨ìˆ˜ë¥¼ ê²°í•©í•˜ëŠ” ê²ƒì„ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬

import user from "./user";
import post from "./post";
// userê³¼ postì˜ reducerë¥¼ import í•´ ì˜´


// combineReducersë¥¼ ì“°ë©´ì„œ ë°”ë€ŒëŠ” ë¶€ë¶„
// const rootReducer == (state = initialState, action) => {
//     switch (action.type) {
//         case HYDRATE:
//             return { ...state, ...action.payload };
    

const rootReducer = combineReducers({
    // SSRì„ ìœ„í•œ index
    index: (state = {}, action) => {
        switch (action.type) {
            case HYDRATE:
                return { ...state, ...action.payload };

            default:
                return state;
        }
    },
    user,
    post,
});

export default rootReducer;
```
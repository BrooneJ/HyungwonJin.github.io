---
layout: post
title: "210824-TIL(Redux-saga)"
subtitle: "TIL-210824"
categories: til
tags: til
comments: false
---

# ğŸ“ ê³µë¶€í•  ê±°ë¦¬
---
- ì“°ë¡œí‹€ë§ê³¼ ë””ë°”ìš´ì‹±       
throttling: ë§ˆì§€ë§‰ í•¨ìˆ˜ê°€ í˜¸ì¶œëœ í›„ ì¼ì • ì‹œê°„ì´ ì§€ë‚˜ê¸° ì „ì— ë‹¤ì‹œ í˜¸ì¶œë˜ì§€ ì•Šë„ë¡ í•˜ëŠ” ê²ƒ    
debouncing: ì—°ì´ì–´ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ë“¤ ì¤‘ ë§ˆì§€ë§‰ í•¨ìˆ˜(ë˜ëŠ” ì œì¼ ì²˜ìŒ)ë§Œ í˜¸ì¶œí•˜ë„ë¡ í•˜ëŠ” ê²ƒ    
<https://www.zerocho.com/category/JavaScript/post/59a8e9cb15ac0000182794fa>


â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ take & takeEvery
---
sagaì—ì„œ actionì´ ë“¤ì–´ì˜¬ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” take ê¸°ëŠ¥ì€ 1ë²ˆ ì‹œí–‰ë˜ê³  ë‚˜ë©´ ë‹¤ì‹œ ì‚¬ìš©í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ë°œìƒí•œë‹¤.      
ì˜ˆë¥¼ ë“¤ì–´ ë¡œê·¸ì¸ì„ 1ë²ˆ í•˜ê³  ë‚˜ë©´ ë‹¤ì‹œ ë¡œê·¸ì¸ í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.        
<br/>

ì´ëŸ° ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ 2ê°€ì§€ ë°©ë²•ì„ ìƒê°í•´ ë³¼ ìˆ˜ ìˆë‹¤.
1. whileë¬¸ì„ ì‚¬ìš©í•œë‹¤.
2. takeEveryë¥¼ ì‚¬ìš©í•œë‹¤.

sagas/index.js
```javascript
function* watchLogIn() {
    yield take('LOG_IN_REQUEST', logIn); //LOG_IN_REQUEST ì´ë¼ëŠ” ëª…ë ¹ì´ ì‹œí–‰ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
} // 1ë²ˆ ì‹¤í–‰í•˜ê³  ë‚˜ë©´ ë‹¤ì‹œ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ìˆìŒ

// 1. whileë¬¸ì„ ì‚¬ìš©í•œ ë°©ë²•
function* watchLogIn() {
    while(true) {
        yield take('LOG_IN_REQUEST', logIn);
    }
}

// 2. takeEveryë¥¼ ì‚¬ìš©í•œ ë°©ë²•
function* watchLogIn() {
    yield takeEvery('LOG_IN_REQUEST', logIn);
}
```     

â˜‘ï¸ ì°¨ì´ì :      
while take: ë™ê¸°ì (sync)        
takeEvery: ë¹„ë™ê¸°ì (async)      

â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ takeLatest & throttle
---     
1. takeLatest      
ì½”ë“œ ì˜ˆì‹œ)      
    ```javascript
    function* watchLogIn() {
        yield takeLatest('LOG_IN_REQUEST', logIn);
    }
    ```   
    ![1-1](/assets/img/web/2021-08-24/1-1.png)      
    ë§Œì•½ ë‘ ë²ˆì„ ë°˜ë³µí•´ì„œ ëˆŒë €ì„ ê²½ìš°ì— ëŒì•„ì˜¨ ì‘ë‹µ ì¤‘ ë§ˆì§€ë§‰ ê²ƒë§Œ ë°›ì•„ë“¤ì¸ë‹¤.      
    <br/>

    ğŸš« ë‹¨ì      
    ë°±ì—”ë“œì—ëŠ” ë°ì´í„°ê°€ ë‘ ë²ˆ ì „ì†¡ë˜ë¯€ë¡œ í”„ë¡ íŠ¸ì—”ë“œì—ì„œë§Œ í•´ë‹¹ë˜ëŠ” ì‚¬í•­ì´ë‹¤.        
    ì¦‰, ìƒˆë¡œ ê³ ì¹¨í•˜ë©´ ë°±ì—”ë“œì—ì„œ ë°›ì•„ì˜¨ ë°ì´í„°ëŠ” 2ê°œê°€ ì €ì¥ë˜ì–´ ìˆê²Œëœë‹¤.

2. throttle     
    ì½”ë“œ ì˜ˆì‹œ)
    ```javascript
    function* watchLogIn() {
        yield throttle('LOG_IN_REQUEST', logIn, 10000);
    }
    ```   
    ì£¼ì–´ì§„ ì‹œê°„ ì•ˆì—ëŠ” 1ë²ˆë§Œ ìš”ì²­í•  ìˆ˜ ìˆë„ë¡ ì œí•œí•œë‹¤.     



â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ saga ìª¼ê°œê¸°
---     
sagas/index.jsì— ëª¨ë“  ì½”ë“œë¥¼ ëª¨ì•„ë†“ìœ¼ë©´ ë„ˆë¬´ ê¸¸ì–´ì ¸ì„œ ë‚˜ëˆ ì¤˜ì•¼í•œë‹¤.     
sagas/user.jsì™€ sagas/post.jsë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.     

sagas/user.js
```javascript
import { all, fork, takeLatest, delay } from "redux-saga/effects";
import axios from "axios";


//function ì œë„¤ë ˆì´í„° ì•„ë‹˜
function logInAPI(data) { // (3) callì„ í•´ì„œ ë°›ì€ logInAPI(action.data)ì„
    return axios.post('/api/login', data);
}

function* logIn(action) { // (1)watchLogIní•¨ìˆ˜ì—ì„œ ë°›ì€ actionì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ìŒ
    try {
        // const result = yield call(logInAPI, action.data); // (2)actionìœ¼ë¡œ ë°›ì€ ë¡œê·¸ì¸ dataê°€ ë“¤ì–´ìˆìŒ
        yield delay(1000);
        yield put({
            type: 'LOG_IN_SUCCESS',
            data: result.data,
        })
    } catch (err) {
        yield put({ // putì€ dispatchë¼ê³  ìƒê°
            type: 'LOG_IN_FAILURE', // Actionì´ë¼ê³  ìƒê°
            data: err.response.data,
        })
    }
}

function logOutAPI() { // ì œë„¤ë ˆì´í„° ì•„ë‹˜
    return axios.post('/api/logout');
}

function* logOut() {
    try {
        // const result = yield call(logOutAPI);
        yield delay(1000);
        yield put({
            type: 'LOG_OUT_SUCCESS',
            data: result.data,
        })
    } catch (err) {
        yield put({
            type: 'LOG_OUT_FAILURE',
            data: err.response.data,
        })
    }
}

function* watchLogIn() {
    yield takeLatest('LOG_IN_REQUEST', logIn); //LOG_IN_REQUEST ì´ë¼ëŠ” ëª…ë ¹ì´ ì‹œí–‰ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
}

function* watchLogOut() {
    yield takeLatest('LOG_OUT_REQUEST', logOut);
}


export default function* userSaga() {
    yield all([
        fork(watchLog),
        fork(watchLogOut),
    ])
}
```
<br/>

sagas/post.js
```javascript
import { all, fork, takeLatest, delay, put } from "redux-saga/effects";

function addPostAPI(data) { // ì œë„¤ë ˆì´í„° ì•„ë‹˜
    return axios.post('/api/post', data);
}

function* addPost(action) {
    try {
        // const result = yield call(addPostAPI, action.data);
        yield delay(1000);
        yield put({
            type: 'Add_POST_SUCCESS',
            data: result.data,
        })
    } catch (err) {
        yield put({
            type: 'Add_POST_FAILURE',
            data: err.response.data,
        })
    }
}


function* watchAddPost() {
    yield takeLatest('ADD_POST_REQUEST', addPost);
}

export default function* postSaga() {
    yield all([
        fork(watchAddPost),
    ])
}
```
<br/>

sagas/index/js
```javascript
import { all, call, fork, put, takeLatest, delay } from "@redux-saga/core/effects";

import postSaga from "./post";
import userSaga from "./user";

export default function* rootSaga() {
    yield all([ // ë°°ì—´ ì•ˆì— ìˆëŠ” ëª¨ë“  ê²ƒì„ ì‹¤í–‰
        fork(postSaga),   // forkëŠ” í•¨ìˆ˜ë¥¼ ì‹¤í–‰
        fork(userSaga),
    ]);
}
```

â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ reducer ì •ë¦¬
---     
reducers/user.js
```javascript
export const initialState = {
    isLoggingIn: false, // ë¡œê·¸ì¸ ì‹œë„ ì¤‘
    isLoggedIn: false,
    isLoggingOut: false, // ë¡œê·¸ì•„ì›ƒ ì‹œë„ ì¤‘
    me: null,
    signUpData: {},
    loginData: {},
}

// loginì— ê´€ë ¨ëœ action 3ê°€ì§€
export const loginRequestAction = (data) => {
    return {
        type: "LOG_IN_REQUEST",
        data,
    }
}

export const loginSuccessAction = (data) => {
    return {
        type: "LOG_IN_SUCCESS",
        data,
    }
}

export const loginFailureAction = () => {
    return {
        type: "LOG_IN_FAILURE",
    }
}

// logoutì— ê´€ë ¨ëœ action 3ê°€ì§€
export const logoutRequestAction = () => {
    return {
        type: "LOG_OUT_REQUEST",
    }
}

export const logoutSuccessAction = () => {
    return {
        type: "LOG_OUT_SUCCESS",
    }
}

export const logoutFailureAction = () => {
    return {
        type: "LOG_OUT_FAILURE",
    }
}


const reducer = (state = initialState, action) => {
    switch (action.type) {

        case 'LOG_IN_REQUEST':
            return {
                ...state,
                isLoggingIn: true,
            }

        case 'LOG_IN_SUCCESS':
            return {
                ...state,
                isLoggingIn: false,
                isLoggedIn: true,
                me: action.data,
            };

        case 'LOG_IN_FAILURE':
            return {
                ...state,
                isLoggingIn: false,
                isLoggedIn: false,
            };

        case 'LOG_OUT_REQUEST':
            return {
                ...state,
                isLoggingOut: true,
            }

        case 'LOG_OUT_SUCCESS':
            return {
                ...state,
                isLoggingOut: false,
                isLoggedIn: false,
                me: null,
            }

        case 'LOG_OUT_FAILURE':
            return {
                ...state,
                isLoggingOut: false,
            }

        default:
            return state
    }
}

export default reducer;
```

component/LoginForm.js        
```javascript
import { useDispatch, useSelector } from "react-redux";

import { loginRequestAction } from "../reducers/user";
...
const LoginForm = () => {
    const { isLoggingIn } = useSelector((state) => state.user);
    ...
    const onSubmitForm = useCallback(() => {
        ...
->     dispatch(loginRequestAction({ id, password }));
        ...
    }, [id, password]);
    return (
        <FormWrapper onFinish={onSubmitForm}>
            ...
            <ButtonWrapper>
->              <Button type="primary" htmlType="submit" loading={isLoggingIn}>ë¡œê·¸ì¸</Button> // loading={false}ì—ì„œ isLogginInìœ¼ë¡œ ë°”ê¿”ì¤Œ
                <Link href="/signup"><a><Button>íšŒì›ê°€ì…</Button></a></Link>
            </ButtonWrapper>
        </FormWrapper>
    )
}
```

component/UserProfile.js        
```javascript
...
import { useDispatch, useSelector } from "react-redux";

import { logoutRequestAction } from '../reducers/user';

const UserProfile = () => {
    const dispatch = useDispatch();
->  const { me, isLoggingOut } = useSelector((state) => state.user);

    const onLogOut = useCallback(() => {
->      dispatch(logoutRequestAction());
    }, [])
    return (
        <Card
            actions={[
                <div key="twit">ì§¹ì§¹<br />0</div>,
                <div key="following">íŒ”ë¡œì‰<br />0</div>,
                <div key="following">íŒ”ë¡œì›Œ<br />0</div>,
            ]}
        >
            <Card.Meta
->              avatar={<Avatar>{me.nickname[0]}</Avatar>} // meë¥¼ ì“¸ ìˆ˜ ìˆê²Œ ë˜ì–´ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŒ
->              title={me.nickname}
            />
->          <Button onClick={onLogOut} loading={isLoggingOut}>ë¡œê·¸ì•„ì›ƒ</Button>
        </Card>
    )
}

export default UserProfile;
```

## ğŸŒŸ ë¡œê·¸ì¸ ì‹¤í–‰ìˆœì„œ        
---
1. component/LoginForm.js íŒŒì¼ì˜        
    ```javascript
    const LoginForm = () => {
        const { isLoggingIn } = useSelector((state) => state.user);
        ...
        const onSubmitForm = useCallback(() => {
            ...
    ->     dispatch(loginRequestAction({ id, password }));
            ...
        }, [id, password]);
        return (
            <FormWrapper onFinish={onSubmitForm}>
                ...
                <ButtonWrapper>
    ->              < type="primary" htmlType="submit" loading={isLoggingIn}>ë¡œê·¸ì¸</ Button> // loading={false}ì—ì„œ isLogginInìœ¼ë¡œ ë°”ê¿”ì¤Œ
                    <Link href="/signup"><a><Button>íšŒì›ê°€ì…</Button></a></Link>
                </ButtonWrapper>
            </FormWrapper>
        )
    }
    ```
    ë¡œê·¸ì¸ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ onFinish={onSubmitForm}ì´ ì‹¤í–‰ë˜ê³  onSubmitForm í•¨ìˆ˜ ì†ì˜ dispatch (loginRequestAction({ id, password }))ì´ ì‹¤í–‰ëœë‹¤.

2. reducers/user.js íŒŒì¼ì˜      
    ```javascript
    export const loginRequestAction = (data) => {
        return {
            type: "LOG_IN_REQUEST",
            data,
        }
    }
    const reducer = (state = initialState, action) => {
        switch (action.type) {

            case 'LOG_IN_REQUEST':
                return {
                    ...state,
                    isLoggingIn: true,
                }
    ```
    loginRequestAction() í•¨ìˆ˜ ì†ì˜ type: "LOG_IN_REQUEST"ê°€ reducerë¡œ ì „ë‹¬ë˜ê³  switchë¬¸ì˜ LOG_IN_REQUESTì— ê±¸ë¦¬ë©° ë¡œê·¸ì¸ì„ ìš”ì²­í•œë‹¤.

3. sagas/user.js íŒŒì¼ì˜     
    ```javascript
    function* logIn(action) { // (1)watchLogIní•¨ìˆ˜ì—ì„œ ë°›ì€ actionì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ìŒ
        try {
            // const result = yield call(logInAPI, action.data); // (2)actionìœ¼ë¡œ ë°›ì€ ë¡œê·¸ì¸   dataê°€ ë“¤ì–´ìˆìŒ
            yield delay(1000);
            yield put({
                type: 'LOG_IN_SUCCESS',
                data: action.data,
                // data: result.data,
            })
        } catch (err) {
            yield put({ // putì€ dispatchë¼ê³  ìƒê°
                type: 'LOG_IN_FAILURE', // Actionì´ë¼ê³  ìƒê°
                data: err.response.data,
            })
        }
    }
    function* watchLogIn() {
        yield takeLatest('LOG_IN_REQUEST', logIn); //LOG_IN_REQUEST ì´ë¼ëŠ” ëª…ë ¹ì´ ì‹œí–‰ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
    }
    export default function* userSaga() {
        yield all([
            fork(watchLogIn),
            fork(watchLogOut),
        ])
    }
    ```
    2ë²ˆê³¼ ë™ì‹œì— watchLogIn() í•¨ìˆ˜ ì†ì—ì„œ LOG_IN_REQUESTì„ ê°ì§€í•˜ê²Œ ë˜ê³  logIn(action)í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©° ë¡œê·¸ì¸ì´ ëœë‹¤.

4. 3ì—ì„œ LOG_IN_SUCCESSê°€ dispatch ë˜ë©´ reducers/user.js íŒŒì¼ì˜      
    ```javascript
    const reducer = (state = initialState, action) => {
        switch (action.type) {
            ...

            case 'LOG_IN_SUCCESS':
                return {
                    ...state,
                    isLoggingIn: false,
                    isLoggedIn: true,
                    me: { ...action.data, nickname: "JIN" },
                };
        }
    }
    ```
    reducerì— ì „ë‹¬ë˜ì–´ LOG_IN_SUCCESS ë©”ì„¸ì§€ë¥¼ ìˆ˜ì‹ í•˜ê³  return ê°’ì„ ì‹¤í–‰í•˜ê²Œ ëœë‹¤. ê·¸ë¦¬ê³  meì— ë°ì´í„°ê°€ ë“¤ì–´ê°. ê·¸ í›„ isLoggedInì´ trueê°€ ë¨.       

5. isLoggedInì´ trueê°€ ë˜ë©´ component/AppLayout.js íŒŒì¼ì˜
    ```javascript
    const AppLayout = ({ children }) => {
        const isLoggedIn = useSelector((state) => state.user.isLoggedIn);
        // isLoggedIn ê°’ì´ ë°”ë€Œë©´ ì•„ë«ê°€ ë¦¬ëœë”ë§ ë¨
        return (
            <div>
                ...
                    <Col xs={24} md={6}>
                        {isLoggedIn ? <UserProfile /> : <LoginForm />}
                    </Col>
                    ...
                </Row>
            </div>
        )
    }
    ```
    isLoggedInê°€ trueê°€ ë˜ê³  ë”ì´ìƒ LoginFromì´ ì•„ë‹Œ UserProfileì„ ì‹¤í–‰í•˜ê²Œ ëœë‹¤.       
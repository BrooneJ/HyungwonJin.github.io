---
layout: post
title: "210820-TIL(Redux)"
subtitle: "TIL-210820"
categories: til
tags: til
comments: false
---

## ğŸŒŸTestë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„° ì…ë ¥
---
reducers/post.js
```javascript       
export const initialState = {
    mainPosts: [{
        id: 1,
        User: { // backì—”ë“œì˜ ìºëŸ¬ì…€ì—ì„œ ì²«ê¸€ìë¥¼ ëŒ€ë¬¸ìë¡œ í•´ì£¼ê¸° ë•Œë¬¸ì— ë§ì¶¤
            id: 1,
            nickname: 'Doraemon',
        },
        content: 'ì²«ë²ˆì§¸ ê²Œì‹œê¸€ #í•´ì‹œíƒœê·¸ #ìµìŠ¤í”„ë ˆìŠ¤',
        Images: [{
            src: "https://images.unsplash.com/photo-1629287120817-458e67b9f641?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=2466&q=80"
        }, {
            src: "https://images.unsplash.com/photo-1466078415375-6d055d48434b?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=2700&q=80"
        }, {
            src: "https://images.unsplash.com/photo-1628020681459-36f808315107?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=2700&q=80"
        }],
        Comments: [{
            User: {
                nickname: 'nero',
            },
            content: 'ë³´ê¸° ì¢‹ìŠµë‹ˆë‹¤.',
        }, {
            User: {
                nickname: 'Pikachu',
            },
            content: "ì•„ë¦„ë‹µë„¤ìš”."
        }]
    }],
    imagePaths: [], // ì´ë¯¸ì§€ê°€ ì €ì¥ë  ê³µê°„
    postAdded: false,
}

const ADD_POST = 'ADD_POST'; // ì˜¤íƒ€ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´
export const addPost = {
    type: ADD_POST,
}

const dummyPost = {
    id: 2,
    content: 'ë”ë¯¸ë°ì´í„° ì…ë‹ˆë‹¤.',
    User: {
        id: 1,
        nickname: 'Doraemon',
    },
    Images: [],
    Comments: []
}

const reducer = (state = initialState, action) => {
    switch (action.type) {
        case ADD_POST:
            return {
                ...state,
                mainPosts: [dummyPost, ...state.mainPosts],
                // ì¶”ê°€ ë˜ëŠ” ê²Œì‹œë¬¼ì„ ì•ì— ì…ë ¥í•´ì•¼ ìµœìƒë‹¨ì— ìœ„ì¹˜í•¨
                postAdded: true,
            }
        default:
            return state
    }
}

export default reducer;
```     
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
## ğŸŒŸê²Œì‹œê¸€ ì˜¬ë¦¬ëŠ” í™”ë©´ ë§Œë“¤ê¸°
---
pages/index.js
```javascript
import { useSelector } from "react-redux";

import AppLayout from "../components/AppLayout";
import PostCard from "../components/PostCard";
import PostForm from "../components/PostForm";


const Home = () => {
    const { isLoggedIn } = useSelector((state) => state.user);
    const { mainPosts } = useSelector((state) => state.post);
    return (
        <AppLayout>
            {isLoggedIn && <PostForm />} //login í–ˆì„ ë–„ë§Œ ê²Œì‹œê¸€ ì‘ì„±í¼ì´ ë³´ì„
            {mainPosts.map((post) => <PostCard key={post.id} post={post} />)}
        </AppLayout>
    )
}

export default Home;
```     
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      

## ğŸŒŸPostForm ì‘ì„±
---
```javascript
import { Form, Button, Input } from "antd";
import { useState, useCallback, useRef } from "react";
import { useSelector, useDispatch } from "react-redux";
import { addPost } from "../reducers/post";

const PostForm = () => {
    const { imagePaths } = useSelector((state) => state.post);
    const dispatch = useDispatch();
    const imageInput = useRef(); // ì‹¤ì œ domì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œ ref ì‚¬ìš©
    const [text, setText] = useState('');
    const onChangeText = useCallback((e) => {
        setText(e.target.value);
    }, []);
    const onSubmit = useCallback(() => {
        dispatch(addPost);
        setText('');
    }, []);
    const onClickImageUpload = useCallback(() => {
        imageInput.current.click();
    }, [imageInput.current]);
    return (
        <Form 
            style={{ margin: '10px 0 20px' }} 
            encType="multipart/form-data" 
            onFinish={onSubmit}
            >
            <Input.TextArea
                value={text}
                onChange={onChangeText}
                maxLength={140}
                placeholder="ì–´ë–¤ ì‹ ê¸°í•œ ì¼ì´ ìˆì—ˆë‚˜ìš”?"
            />
            <div>
                <input type="file" multiple hidden ref={imageInput} />//ì´ë¯¸ì§€ ì—…ë¡œë“œ
                <Button onClick={onClickImageUpload}>ì´ë¯¸ì§€ ì—…ë¡œë“œ</Button>
                <Button type="primary" style={{ float: "right" }} htmlType="submit">ì§¹ì§¹</Button>
            </div>
            <div>
                {imagePaths.map((v) => (
                    <div key={v} style={{ display: "inline-block " }}>
                        <img src={v} style={{ width: '200px ' }} alt={v} />
                        <div>
                            <Button>ì œê±°</Button>
                        </div>
                    </div>
                ))}
            </div>

        </Form>
    )
}

export default PostForm;
```     
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°          

## ğŸŒŸoptional chaining ì—°ì‚°ì
---
```javascript
const { me } = useSelector((state) => state.user);
const id = me?.id;
                |
                |
                V
const id = useSelector((state) => state.user.me?.id);
```     
â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
## ğŸŒŸPostCard
---

---
layout: post
title: "210902-TIL(React)"
subtitle: "TIL-210902"
categories: til
tags: til
comments: false
---

# ğŸ“ ê³µë¶€í•  ê±°ë¦¬
---



â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ post Unauthorize error
---
### ğŸš” ë¬¸ì œ ë°œê²¬ 
---
![1-1](/assets/img/web/2021-09-02/1-1.png)          
ë¸Œë¼ìš°ì €ëŠ” 3000ë²ˆ í¬íŠ¸, ë°±ì—”ë“œëŠ” 3065 í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤. ë”°ë¼ì„œ í˜„ì¬ëŠ” ë„ë©”ì¸ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— cookieê°€ ì „ë‹¬ë˜ì§€ ì•Šê³  ìˆì–´ ë°±ì—”ë“œì—ì„œëŠ” postë¥¼ ëˆ„ê°€ ë³´ë‚¸ ê²ƒì¸ì§€ ì•Œ ë°©ë²•ì´ ì—†ë‹¤.       
ê·¸ë˜ì„œ í˜„ì¬ ë¡œê·¸ì¸í•˜ê³  ìˆìŒì—ë„ ë¶ˆêµ¬ë¼ê³  401 Unauthorizedë¼ëŠ” ë©”ì„¸ì§€ë¥¼ ë°›ê²Œ ë˜ì—ˆë‹¤.     

### ğŸ” í•´ê²° ë°©ë²•
---
1. proxyë¡œ í•´ê²°í•˜ëŠ” ë°©ë²•
2. corsë¡œ í•´ê²°í•˜ëŠ” ë°©ë²•     

ì—¬ê¸°ì„œëŠ” corsë¡œ í•´ê²°í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•œë‹¤.       
ğŸ—‚ back/app.js
```javascript
app.use(cors({
    origin: '*', // Access-controll-allow-origin
->  credentials: true, // Access-controll-allow-credentials
}));
```
ğŸ—‚ sagas/post.js        
```javascript
function addPostAPI(data) { // ì œë„¤ë ˆì´í„° ì•„ë‹˜
    return axios.post('/post', { content: data }, {
        withCredentials: true,
    });
}
```
withCredentialsë¥¼ trueë¡œ í•´ì£¼ë©´ ì¿ í‚¤ë„ ê°™ì´ ì „ì†¡ëœë‹¤.

<br/>

ë˜ëŠ” 

ğŸ—‚ sagas/index.js
```javascript
axios.defaults.withCredentials = true;
```
ìœ„ì™€ ê°™ì€ ì½”ë“œë¥¼ ì…ë ¥í•´ë‘ë©´ ëª¨ë“  APIì— ì§ì ‘ ì…ë ¥í•  í•„ìš”ê°€ ì—†ì–´ì§„ë‹¤.     
<br/>

í•˜ì§€ë§Œ ì´ë ‡ê²Œí•˜ë©´ ë‘ë²ˆì§¸ ë¬¸ì œê°€ ë°œìƒí•˜ê²Œ ëœë‹¤.      
![1-1](/assets/img/web/2021-09-02/1-2.png)          

ì´ëŠ” withCredentialsë¥¼ trueë¡œ í•´ì¤¬ê¸° ë•Œë¬¸ì— ì¼ì–´ë‚˜ëŠ” ë¬¸ì œì´ë‹¤.      
ë³´ì•ˆì„ ì² ì €í•˜ê²Œ í•˜ê¸° ìœ„í•´ì„œ orginì— ì•„ë¬´ë‚˜ í—ˆìš©ë˜ì§€ ì•Šê²Œ ì •í™•í•œ ì£¼ì†Œë¥¼ ì ì–´ë‹¬ë¼ëŠ” ê²ƒì´ë‹¤. 

ğŸ—‚ sagas/app.js
```javascript
app.use(cors({
    origin: '*',
    credentials: true,
}));
```

### âœ… í•´ê²°
---
![1-1](/assets/img/web/2021-09-02/1-3.png)          
ìœ„ì˜ ê·¸ë¦¼ê³¼ ê°™ì´ statusì˜ ìƒíƒœê°€ 200ë²ˆ ëŒ€ë¡œ ë°”ë€ŒëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.     


â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ ë¡œê·¸ì¸ í›„ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ” ë°©ë²•
---
ë©”ëª¨ë¦¬ì— ì €ì¥ëœ ì¿ í‚¤ë¥¼ í†µí•´ì„œ í•œë²ˆ ë¡œê·¸ì¸ í•œ í›„ì— ìƒˆë¡œê³ ì¹¨ì„ í•´ë„ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ìœ ì§€í•˜ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆë‹¤.        

1. í™ˆí™”ë©´ì— ì ‘ê·¼        
ğŸ—‚ page/index.js        
```javascript
const Home = () => {
    ...
    useEffect(() => {
            dispatch({
                type: LOAD_MY_INFO_REQUEST,
            })
            dispatch({
                type: LOAD_MY_INFO_REQUEST,
            });
        }, []);
}
```
ìœ„ì˜ ì½”ë“œë¡œ í™ˆì— ì ‘ê·¼í•˜ë©´ ë¡œê·¸ì¸ ìœ ì €ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” LOAD_MY_INFO_REQUEST ì•¡ì…˜ê³¼ ê²Œì‹œë¬¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” LOAD_MY_INFO_REQUEST ì•¡ì…˜ì´ ë™ì‹œì— ì‹¤í–‰ë¨        

2. LOAD_MY_INFO_REQUEST ì•¡ì…˜ì„ ë³´ë‚¸ í›„ sagaë¡œ ë³´ë‚´ì§€ë©´      
ğŸ—‚ saga/user.js
```javascript
function loadUserAPI() {
    return axios.get('/user'); // ì •ë³´ë¥¼ ë³€ê²½í•˜ê±°ë‚˜ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê¸° ë–„ë¬¸ì— get
}

function* loadUser(action) {
    try {
        const result = yield call(loadUserAPI, action.data);
        yield put({
            type: LOAD_MY_INFO_SUCCESS,
            data: result.data,
        })
    } catch (err) {
        yield put({
            type: LOAD_MY_INFO_FAILURE,
            error: err.response.data,
        })
    }
}
```
ìœ„ì˜ ì œë„¤ë ˆì´í„°ë¥¼ í†µí•´ì„œ resultì— ë‹´ê¸´ ë°ì´í„°ê°€ http://localhost:3000/userë¡œ ë³´ë‚´ì§„ë‹¤.      
<br/>

ì‚¬ì‹¤ ë°±ì—”ë“œë¥¼ ë‹¤ ì„¤ì • í•´ë†“ì•˜ìœ¼ë©´ í”„ë¡ íŠ¸ì—”ë“œì—ì„œì˜ ì—­í• ì€ ì—¬ê¸°ì„œ ë      
(í•˜ì§€ë§Œ í˜„ì¬ ë°±ì—”ë“œì—ì„œ í”„ë¡ íŠ¸ì—”ë“œë¡œ ë¹¼ê±°ë‚˜ ì¶”ê°€í•´ì•¼í•  ì •ë³´ê°€ ìˆìœ¼ë¯€ë¡œ..)       
<br/>

3. ë°±ì—”ë“œì—ì„œëŠ” 
ğŸ—‚ routes/user.js       
```javascript
router.get('/', async (req, res, next) => { // get /user
    try {
        if (req.user) {
            const fullUserWithoutPassword = await User.findOne({
                where: { id: req.user.id },
                attributes: {
                    exclude: ['password']
                },
                include: [{
                    model: Post,
                    attributes: ['id'],
                }, {
                    model: User,
                    as: 'Followings',
                    attributes: ['id'],
                }, {
                    model: User,
                    as: 'Followers',
                    attributes: ['id'],
                }]
            })
            res.status(200).json(fullUserWithoutPassword);
        } else {
            res.status(200).json(null);
        }
    } catch (error) {
        console.error(error);
        next(error);
    }
})
```
fullUserWithoutPasswordë¼ëŠ” ë³€ìˆ˜ì— user.idë¥¼ í†µí•´ì„œ ìœ ì €ë¥¼ ì°¾ê³  í•´ë‹¹ìœ ì €ì˜ post, Followings, Followersë¥¼ í”„ë¡ íŠ¸ë¡œ ë³´ë‚´ì¤€ë‹¤.     

â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ ê²Œì‹œê¸€ì„ ì›í•˜ëŠ” ë‹¨ìœ„ ë§Œí¼ ëŠì–´ì„œ ê°€ì ¸ì˜¤ê¸°
---
routes/posts.js     
```javascript
const posts = await Post.findAll({
        limit: 10, // ëª‡ê°œì”© ê°€ì ¸ì˜¬ ê²ƒì¸ê°€?
        offset: 0, // ëª‡ë²ˆ ë¶€í„° ê°€ì ¸ì˜¬ ê²ƒì¸ê°€?
    });
```

â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

## ğŸŒŸ SequelizeDatabaseError: Unknown column 'Images.PostId' in 'field list' ë¬¸ì œ
---

### ğŸš” ë¬¸ì œ ë°œê²¬ 
---
ê²Œì‹œë¬¼ì„ ì‘ì„±í•´ë„ í™”ë©´ì´ ë‚˜íƒ€ë‚˜ì§€ ì•ŠëŠ” ê²ƒì„ ë°œê²¬        
ì¦‰, DBì—ì„œ postë“¤ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í•˜ëŠ” í˜„ìƒì„ ë°œê²¬     

### ğŸ” í•´ê²° ë°©ë²•
---
![1-1](/assets/img/web/2021-09-02/1-6.png)        
![1-1](/assets/img/web/2021-09-02/1-7.png)        
ìœ„ì˜ ì´ë¯¸ì§€ì—ëŠ” ì´ë¯¸ í•´ê²°í•œ í›„ì´ì§€ë§Œ        
reduxì—ì„œ LOAD_POST_FAILUREì´ë¼ëŠ” ì•¡ì…˜ê³¼ ë¸Œë¼ìš°ì €ì˜ network ì°½ì—ì„œëŠ” Status Code 500ì´ ê³„ì† í‘œì‹œë˜ì—ˆë‹¤.     
<br/>

ê·¸ë˜ì„œ reduxì™€ redux-sagaì˜ ì½”ë“œë¥¼ í™•ì¸í•´ë³´ì•˜ì§€ë§Œ ì˜¤ë¥˜ëŠ” ì—†ì–´ë³´ì˜€ë‹¤.        

ê·¸ë‹¤ìŒìœ¼ë¡œ ë°±ì—”ë“œ ìª½ì„ ì‚´í´ë³´ì•˜ë‹¤.      
![1-1](/assets/img/web/2021-09-02/1-4.png)        
ì•Œìˆ˜ ì—†ëŠ” Images.PostId ë¼ëŠ” columnì´ field listì— ìˆë‹¤ë¼ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆì§€ë§Œ ë¬´ìŠ¨ ëœ»ì¸ì§€ ì´í•´í•˜ì§€ ëª»í–ˆë‹¤.      

ì™œëƒí•˜ë©´ ëŒ€ë¶€ë¶„ ì˜¤ë¥˜ê°€ ìˆì„ ê²½ìš°ëŠ” ì˜¤íƒ€ì´ê±°ë‚˜ ë¹ ì§„ ë¶€ë¶„ì´ ìˆê±°ë‚˜ í–ˆê¸° ë–„ë¬¸ì— ë°ì´í„°ë² ì´ìŠ¤ì— ë¹ ì§„ ìš”ì†Œê°€ ìˆì„ ê²ƒì´ë¼ê³  ìƒê°í•˜ì§€ ëª»í–ˆì—ˆê¸° ë•Œë¬¸ì´ë‹¤.       

êµ¬ê¸€ì— **'SequelizeDatabaseError: Unknown column 'Images.PostId' in 'field list'**ë¥¼ ê²€ìƒ‰í–ˆì„ ë•Œ ë¬¸ì œëŠ” ëŒ€ë¶€ë¶„ 2ê°€ì§€ ë¼ê³  í–ˆë‹¤.     

1. DBì— columnì´ ì—†ëŠ” ê²½ìš°(ì„¤ë§ˆ ì´ëŸ°ì¼ì´?)      
2. ì‚¬ìš©ìê°€ ì¤€ ë°ì´í„°ê°€ ë¬¸ìì—´ë¡œ í‘œì‹œë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš°        

2ë²ˆì€ ë‚´ê°€ ì§ì ‘ ë°ì´í„°ë² ì´ìŠ¤ì˜ ê°’ì„ ì„¤ì •í•˜ê±°ë‚˜ í•œê²Œ ì•„ë‹ˆë¼ sequelizeì—ì„œ ë§Œë“¤ì–´ ì£¼ê³  ìˆê¸° ë•Œë¬¸ì— ì•„ë‹ˆë¼ê³  ìƒê°í•´ì„œ DBë¥¼ ì‚´í´ë³´ê¸°ë¡œ í–ˆë‹¤.        

MySQLWorkbenchë¥¼ ì¼œê³  Images í…Œì´ë¸”ì„ ë³´ì•˜ë”ë‹ˆ ìˆì–´ì•¼í•  PostIdê°€ ë³´ì´ì§€ ì•Šì•˜ë‹¤.

>ğŸ—‚ back/models/image.js
>```javascript
>module.exports = (sequelize, DataTypes) => {
>    const Image = sequelize.define('Image', { // MySQLë„¤ë¯ Image í…Œì´ë¸” ìƒì„±
>        // MySQLì—ì„œ ë§Œë“¤ì–´ì£¼ëŠ” ê¸°ë³¸ idê°€ ìˆë‹¤.
>        src: {
>            type: DataTypes.STRING(200),
>            allowNull: false,
>        },
>    }, {
>        charset: 'utf8',
>        collate: 'utf8_general_ci', // í•œê¸€ ì €ì¥
>    });
>    Image.associate = (db) => {
>        db.Image.belongsTo(db.Post);
>    };
>    return Image;
>}
>```
>ì´ ë•Œ ë¶„ëª… ë‹¤ ë§Œë“¤ì–´ë†¨ëŠ”ë° ì™œ PostIdê°€ ìƒì„±ë˜ì§€ ì•Šì€ ê²ƒì¸ì§€ëŠ” ì•„ì§ë„ ì•Œ ìˆ˜ ì—†ëŠ” ìˆ˜ìˆ˜ê»˜ë¼...(ëª¨ë“  í…Œì´ë¸”ì—ì„œ ë‹¤ PostIdê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ì—ˆë‹¤.)

ê·¸ë˜ì„œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ DROP í•˜ê³  ìƒˆë¡œ ìƒì„±í–ˆë”ë‹ˆ ì˜ ì‘ë™í•˜ê²Œ ë˜ì—ˆë‹¤.

### âœ… í•´ê²°
---
![1-1](/assets/img/web/2021-09-02/1-6.png)        
![1-1](/assets/img/web/2021-09-02/1-7.png)      
ì´ì œëŠ” ë¬¸ì œê°€ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤!      

â›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°ğŸ”ğŸ—»ğŸŒ‹ğŸâ›°      
<br/>

